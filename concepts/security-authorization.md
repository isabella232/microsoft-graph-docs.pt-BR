---
title: Autorização e API de Segurança do Microsoft Graph
description: Os dados de segurança acessíveis por meio da API de Segurança do Microsoft Graph são confidenciais e protegidos por permissões e funções do Azure AD (Azure Active Directory).
author: preetikr
localization_priority: Priority
ms.prod: security
ms.openlocfilehash: 1911a454b5d4e9c131b2854ff71a81c6e0afeeda
ms.sourcegitcommit: ef8eac3cf973a1971f8f1d41d75a085fad3690f0
ms.translationtype: HT
ms.contentlocale: pt-BR
ms.lasthandoff: 11/15/2019
ms.locfileid: "38656498"
---
# <a name="authorization-and-the-microsoft-graph-security-api"></a><span data-ttu-id="d669f-103">Autorização e API de Segurança do Microsoft Graph</span><span class="sxs-lookup"><span data-stu-id="d669f-103">Authorization and the Microsoft Graph Security API</span></span>

<span data-ttu-id="d669f-104">Os dados de segurança acessíveis por meio da API de Segurança do Microsoft Graph são confidenciais e protegidos por permissões e funções do Azure AD (Azure Active Directory).</span><span class="sxs-lookup"><span data-stu-id="d669f-104">Security data accessible via the Microsoft Graph Security API is sensitive and protected by both permissions and Azure Active Directory (Azure AD) roles.</span></span>

<span data-ttu-id="d669f-105">A API de Segurança do Microsoft Graph dá suporte a dois tipos de autorização:</span><span class="sxs-lookup"><span data-stu-id="d669f-105">The Microsoft Graph Security API supports two types of authorization:</span></span>

- <span data-ttu-id="d669f-106">**Autorização no nível de aplicativo** - não há usuário conectado (por exemplo, um cenário SIEM).</span><span class="sxs-lookup"><span data-stu-id="d669f-106">**Application-level authorization** - There is no signed-in user (for example, a SIEM scenario).</span></span> <span data-ttu-id="d669f-107">As permissões concedidas ao aplicativo determinam a autorização.</span><span class="sxs-lookup"><span data-stu-id="d669f-107">The permissions granted to the application determine authorization.</span></span> 
    ><span data-ttu-id="d669f-108">**Observação:** Esta opção também pode suportar casos em que o RBAC (controle de acesso baseado em função) é gerenciado pelo aplicativo.</span><span class="sxs-lookup"><span data-stu-id="d669f-108">**Note:** This option can also support cases where Role-Based Access Control (RBAC) is managed by the application.</span></span>
- <span data-ttu-id="d669f-109">**Autorização delegada pelo usuário** - um usuário que é um membro do locatário do Microsoft Azure AD está conectado.</span><span class="sxs-lookup"><span data-stu-id="d669f-109">**User delegated authorization** - A user who is a member of the Azure AD tenant is signed in.</span></span> <span data-ttu-id="d669f-110">O usuário deve ser um membro de uma função de administrador do Microsoft Azure AD limitado, o leitor de segurança ou o administrador de segurança, além de o aplicativo ter recebido as permissões necessárias.</span><span class="sxs-lookup"><span data-stu-id="d669f-110">The user must be a member of an Azure AD Limited Admin role - either Security Reader or Securty Administrator - in addition to the application having been granted the required permissions.</span></span>

<span data-ttu-id="d669f-111">Se você estiver chamando a API de Segurança do Microsoft Graph no Explorador do Graph:</span><span class="sxs-lookup"><span data-stu-id="d669f-111">If you're calling the Microsoft Graph Security API from Graph Explorer:</span></span>

- <span data-ttu-id="d669f-112">O administrador do locatário do Microsoft Azure AD deve conceder explicitamente o consentimento das permissões solicitadas ao aplicativo do Explorador do Graph.</span><span class="sxs-lookup"><span data-stu-id="d669f-112">The Azure AD tenant admin must explicitly grant consent for the requested permissions to the Graph Explorer application.</span></span>
- <span data-ttu-id="d669f-113">O usuário deve ser um membro da função administrador limitado do leitor de segurança no Microsoft Azure AD (leitor de segurança ou administrador de segurança).</span><span class="sxs-lookup"><span data-stu-id="d669f-113">The user must be a member of the Security Reader Limited Admin role in Azure AD (either Security Reader or Security Administrator).</span></span>

><span data-ttu-id="d669f-114">**Observação**: O Explorador do Graph não suporta autorização no nível de aplicativo.</span><span class="sxs-lookup"><span data-stu-id="d669f-114">**Note**: Graph Explorer does not support application-level authorization.</span></span>

<span data-ttu-id="d669f-115">Se você estiver chamando a API de Segurança do Microsoft Graph de um aplicativo personalizado ou do seu próprio:</span><span class="sxs-lookup"><span data-stu-id="d669f-115">If you're calling the Microsoft Graph Security API from a custom or your own application:</span></span>

- <span data-ttu-id="d669f-116">O administrador de locatário do Microsoft Azure AD deve conceder explicitamente o consentimento para o aplicativo.</span><span class="sxs-lookup"><span data-stu-id="d669f-116">The Azure AD tenant admin must explicitly grant consent to your application.</span></span> <span data-ttu-id="d669f-117">Isso é necessário para autorização no nível de aplicativo e autorização delegada pelo usuário.</span><span class="sxs-lookup"><span data-stu-id="d669f-117">This is required both for application-level authorization and user delegated authorization.</span></span>
- <span data-ttu-id="d669f-118">Se você estiver usando autorização delegada do usuário, o usuário deverá ser membro da função Administrador Limitado do Leitor de Segurança ou administrador de segurança no Microsoft Azure AD.</span><span class="sxs-lookup"><span data-stu-id="d669f-118">If you're using user delegated authorization, the user must be a member of the Security Reader or Security Administrator Limited Admin role in Azure AD.</span></span>

## <a name="manage-authorization-in-security-api-client-applications"></a><span data-ttu-id="d669f-119">Gerenciar autorizações nos aplicativos de clientes de API de segurança</span><span class="sxs-lookup"><span data-stu-id="d669f-119">Manage authorization in security API client applications</span></span>

<span data-ttu-id="d669f-120">Os dados de segurança fornecidos por meio da API de Segurança do Microsoft Graph são confidenciais e devem ser protegidos por mecanismos de autenticação e autorização apropriados.</span><span class="sxs-lookup"><span data-stu-id="d669f-120">Security data provided via the Microsoft Graph Security API is sensitive and must be protected by appropriate authentication and authorization mechanisms.</span></span> <span data-ttu-id="d669f-121">A tabela a seguir lista as etapas para registrar e criar um aplicativo cliente que pode acessar a API de Segurança do Microsoft Graph.</span><span class="sxs-lookup"><span data-stu-id="d669f-121">The following table lists the steps to register and create a client application that can access the Microsoft Graph Security API.</span></span>

| <span data-ttu-id="d669f-122">**Quem**</span><span class="sxs-lookup"><span data-stu-id="d669f-122">**Who**</span></span> | <span data-ttu-id="d669f-123">**Ação**</span><span class="sxs-lookup"><span data-stu-id="d669f-123">**Action**</span></span> |
|:---------------------|:------------------|
|<span data-ttu-id="d669f-124">Desenvolvedor ou proprietário do aplicativo</span><span class="sxs-lookup"><span data-stu-id="d669f-124">Application developer or owner</span></span>|<span data-ttu-id="d669f-125">Registar o aplicativo como um aplicativo de empresa.</span><span class="sxs-lookup"><span data-stu-id="d669f-125">Register the application as an enterprise application.</span></span>|
|<span data-ttu-id="d669f-126">Administrador de locatários</span><span class="sxs-lookup"><span data-stu-id="d669f-126">Tenant admin</span></span>|<span data-ttu-id="d669f-127">Conceda permissões para o aplicativo.</span><span class="sxs-lookup"><span data-stu-id="d669f-127">Grant permissions to the application.</span></span>|
|<span data-ttu-id="d669f-128">Administrador de locatários</span><span class="sxs-lookup"><span data-stu-id="d669f-128">Tenant admin</span></span>|<span data-ttu-id="d669f-129">Atribuir funções aos usuários.</span><span class="sxs-lookup"><span data-stu-id="d669f-129">Assign roles to users.</span></span>|
|<span data-ttu-id="d669f-130">Desenvolvedor do aplicativo</span><span class="sxs-lookup"><span data-stu-id="d669f-130">Application developer</span></span>|<span data-ttu-id="d669f-131">Entre como usuário e use o aplicativo para acessar a API de Segurança do Microsoft Graph.</span><span class="sxs-lookup"><span data-stu-id="d669f-131">Sign in as the user and use the application to access the Microsoft Graph Security API.</span></span>|

<span data-ttu-id="d669f-132">O registro do aplicativo define somente quais permissões o mesmo precisa para ser executado.</span><span class="sxs-lookup"><span data-stu-id="d669f-132">Application registration only defines which permissions the application needs in order to run.</span></span> <span data-ttu-id="d669f-133">Ele NÃO concede estas permissões ao aplicativo.</span><span class="sxs-lookup"><span data-stu-id="d669f-133">It does NOT grant these permissions to the application.</span></span>

<span data-ttu-id="d669f-134">O administrador de locatários do Microsoft Azure AD tem que conceder explicitamente a permissão ao aplicativo.</span><span class="sxs-lookup"><span data-stu-id="d669f-134">The Azure AD tenant administrator MUST explicitly grant the permissions to the application.</span></span> <span data-ttu-id="d669f-135">Isso precisa ser feito por locatário e tem que ser *executado sempre que* as permissões do aplicativo forem alteradas no portal de registro do aplicativo.</span><span class="sxs-lookup"><span data-stu-id="d669f-135">This must be done per tenant and must be *performed every time* the application permissions are changed in the application registration portal.</span></span>

<span data-ttu-id="d669f-136">Por exemplo, suponha que você tenha um aplicativo, dois locatários do Microsoft Azure AD, **T1** e **T2**, e duas permissões **P1** e **P2**.</span><span class="sxs-lookup"><span data-stu-id="d669f-136">For example, assume that you have an application, two Azure AD tenants, **T1** and **T2**, and two permissions, **P1** and **P2**.</span></span> <span data-ttu-id="d669f-137">O processo de autorização será assim:</span><span class="sxs-lookup"><span data-stu-id="d669f-137">The following is the authorization process:</span></span>

- <span data-ttu-id="d669f-138">O aplicativo registra para exigir permissão **P1**.</span><span class="sxs-lookup"><span data-stu-id="d669f-138">The application registers to require permission **P1**.</span></span>
- <span data-ttu-id="d669f-139">Quando os usuários no locatário **T1** recebem um token do Microsoft Azure AD para esse aplicativo, o token não contém nenhuma permissão.</span><span class="sxs-lookup"><span data-stu-id="d669f-139">When users in tenant **T1** get an Azure AD token for this application, the token does not contain any permissions.</span></span>
- <span data-ttu-id="d669f-140">O administrador de locatários do Microsoft Azure AD **T1** concede permissões explicitamente para o aplicativo.</span><span class="sxs-lookup"><span data-stu-id="d669f-140">The Azure AD admin of tenant **T1** explicitly grants permissions to the application.</span></span> <span data-ttu-id="d669f-141">Quando os usuários no locatário **T1** recebem um token do Microsoft Azure AD para o aplicativo, ele contém a permissão **P1**.</span><span class="sxs-lookup"><span data-stu-id="d669f-141">When users in tenant **T1** get an Azure AD token for the application, it will contain permission **P1**.</span></span>
- <span data-ttu-id="d669f-142">Quando os usuários no locatário **T2** recebem um token do Microsoft Azure AD para o aplicativo, o token não contém nenhuma permissão - porque o administrador de locatários **T2** ainda não concedeu permissões ao aplicativo.</span><span class="sxs-lookup"><span data-stu-id="d669f-142">When users in tenant **T2** get an Azure AD token for the application, the token does not contain any permissions - because the admin of tenant **T2** did not yet grant permissions to the application.</span></span> <span data-ttu-id="d669f-143">A permissão deve ser concedida *por locatário* e *por aplicativo*.</span><span class="sxs-lookup"><span data-stu-id="d669f-143">Permission must be granted *per tenant* and *per application*.</span></span>
- <span data-ttu-id="d669f-144">O aplicativo agora tem seu registro alterado para requerer as permissões **P1** e **P2**.</span><span class="sxs-lookup"><span data-stu-id="d669f-144">The application has its registration changed to now require permissions **P1** and **P2**.</span></span>
- <span data-ttu-id="d669f-145">Quando os usuários no locatário **T1** recebem um token do Microsoft Azure AD para o aplicativo, ele contém apenas a permissão **P1**.</span><span class="sxs-lookup"><span data-stu-id="d669f-145">When users in tenant **T1** get an Azure AD token for the application, it only contains permission **P1**.</span></span> <span data-ttu-id="d669f-146">As permissões concedidas a um aplicativo são registradas como instantâneos do que foi a elas concedido - as mesmas *não são alteradas automaticamente* depois que o registro do aplicativo (permissão) é alterado.</span><span class="sxs-lookup"><span data-stu-id="d669f-146">Permissions granted to an application are recorded as snapshots of what was granted - they *do not change automatically* after the application registration (permission) changes.</span></span>
- <span data-ttu-id="d669f-147">O administrador de locatários **T2** concede as permissões **P1** e **P2** do aplicativo.</span><span class="sxs-lookup"><span data-stu-id="d669f-147">The admin of tenant **T2** grants permissions **P1** and **P2** to the application.</span></span> <span data-ttu-id="d669f-148">Agora, quando os usuários no locatário **T2** recebem um token do Microsoft Azure AD para o aplicativo, ele contém as permissões **P1** e **P2**.</span><span class="sxs-lookup"><span data-stu-id="d669f-148">Now, when users in tenant **T2** get an Azure AD token for the application, the token will contain permissions **P1** and **P2**.</span></span>

><span data-ttu-id="d669f-149">**Observação**: Os tokens do Microsoft Azure AD para os aplicativos no locatário **T1** e no locatário **T2** contêm permissões distintas, porque cada administrador de locatário concedeu permissões diferentes ao aplicativo.</span><span class="sxs-lookup"><span data-stu-id="d669f-149">**Note**: The Azure AD tokens for the application in tenant **T1** and the application in tenant **T2** contain different permissions, because each tenant admin has granted different permissions to the application.</span></span>

- <span data-ttu-id="d669f-150">Para que o aplicativo funcione novamente no locatário **T1**, o administrador de locatários **T1** deve conceder explicitamente as permissões **P1** e **P2** ao aplicativo.</span><span class="sxs-lookup"><span data-stu-id="d669f-150">To make the application work again in tenant **T1**, the admin of tenant **T1** must explicitly grant permissions **P1** and **P2** to the application.</span></span>

## <a name="register-an-application-with-the-microsoft-identity-platform-endpoint"></a><span data-ttu-id="d669f-151">Registrar um aplicativo com o ponto de extremidade da plataforma de identidade da Microsoft </span><span class="sxs-lookup"><span data-stu-id="d669f-151">Register an application with the Microsoft identity platform endpoint</span></span>

<span data-ttu-id="d669f-152">Para registrar um aplicativo com o ponto de extremidade da plataforma de identidade da Microsoft, você precisará:</span><span class="sxs-lookup"><span data-stu-id="d669f-152">To register an application to the Microsoft identity platform endpoint, you'll need:</span></span>

- <span data-ttu-id="d669f-153">**Nome do aplicativo** - uma cadeia de caracteres usada para o nome do aplicativo.</span><span class="sxs-lookup"><span data-stu-id="d669f-153">**Application name** - A string used for the application name.</span></span>
- <span data-ttu-id="d669f-154">**URL de redirecionamento** - o URL no qual a resposta de autenticação do Microsoft Azure AD é enviada.</span><span class="sxs-lookup"><span data-stu-id="d669f-154">**Redirect URL** - The URL where the authentication response from Azure AD is sent.</span></span> <span data-ttu-id="d669f-155">Para começar, você pode usar a homepage do aplicativo Web do cliente de teste.</span><span class="sxs-lookup"><span data-stu-id="d669f-155">To start, you can use the test client web app homepage.</span></span>
- <span data-ttu-id="d669f-156">**Permissões necessárias** - As permissões que seu aplicativo requer para poder chamar o Microsoft Graph.</span><span class="sxs-lookup"><span data-stu-id="d669f-156">**Required Permissions** - The permissions that your application requires to be able to call Microsoft Graph.</span></span>

<span data-ttu-id="d669f-157">Para registrar seu aplicativo:</span><span class="sxs-lookup"><span data-stu-id="d669f-157">To register your application:</span></span>

1. <span data-ttu-id="d669f-158">Vá para o [portal de registro do aplicativo Azure](https://go.microsoft.com/fwlink/?linkid=2083908) e conecte-se.</span><span class="sxs-lookup"><span data-stu-id="d669f-158">Go to the [Azure app registration portal](https://go.microsoft.com/fwlink/?linkid=2083908) and sign in.</span></span>
    ><span data-ttu-id="d669f-159">**Observação**: não é necessário ser um administrador de locatários. Você será redirecionado para a lista **Meus aplicativos**.</span><span class="sxs-lookup"><span data-stu-id="d669f-159">**Note**: You don't have to be a tenant admin. You will be redirected to the **My applications** list.</span></span>
2. <span data-ttu-id="d669f-160">Selecione **Novo registro**.</span><span class="sxs-lookup"><span data-stu-id="d669f-160">Choose **New registration**.</span></span>
3. <span data-ttu-id="d669f-161">Na página de registro do novo aplicativo, digite um valor para **Nome** e selecione os tipos de conta aos quais deseja dar suporte.</span><span class="sxs-lookup"><span data-stu-id="d669f-161">On the registration page for the new application, enter a value for **Name** and select the account types you wish to support.</span></span> <span data-ttu-id="d669f-162">No campo **URI de redirecionamento**, insira o URL de redirecionamento.</span><span class="sxs-lookup"><span data-stu-id="d669f-162">In the **Redirect URI** field, enter the redirect URL.</span></span>
4. <span data-ttu-id="d669f-163">Selecione **Registrar** para criar o aplicativo e exibir a respectiva página de visão geral.</span><span class="sxs-lookup"><span data-stu-id="d669f-163">Select **Register** to create the app and view its overview page.</span></span> *
5. <span data-ttu-id="d669f-164">Acesse a página**permissões de API** do aplicativo.</span><span class="sxs-lookup"><span data-stu-id="d669f-164">Go to the app's **API permissions** page.</span></span>
6. <span data-ttu-id="d669f-165">Selecione **Adicionar uma permissão** e selecione **Microsoft Graph** no submenu.</span><span class="sxs-lookup"><span data-stu-id="d669f-165">Select **Add a permission** and then choose **Microsoft Graph** in the flyout.</span></span> <span data-ttu-id="d669f-166">Selecione **Permissões delegadas**.</span><span class="sxs-lookup"><span data-stu-id="d669f-166">Select **Delegated permissions**.</span></span> <span data-ttu-id="d669f-167">Use a caixa de pesquisa para localizar e selecionar as permissões necessárias.</span><span class="sxs-lookup"><span data-stu-id="d669f-167">Use the search box to find and select the required permissions.</span></span> <span data-ttu-id="d669f-168">Para obter uma lista de permissões, consulte [Permissões de segurança](permissions-reference.md#security-permissions).</span><span class="sxs-lookup"><span data-stu-id="d669f-168">For a list of permissions, see [Security permissions](permissions-reference.md#security-permissions).</span></span>

    ><span data-ttu-id="d669f-169">**Observação** A API de Segurança do Microsoft Graph requer o escopo \*.Read.All para consultas GET, e o escopo \*.ReadWrite.All para consultas PATCH/POST/DELETE.</span><span class="sxs-lookup"><span data-stu-id="d669f-169">**Note:** The Microsoft Graph Security API requires the \*.Read.All scope for GET queries, and the \*.ReadWrite.All scope for PATCH/POST/DELETE queries.</span></span>

    |<span data-ttu-id="d669f-170">Permissão</span><span class="sxs-lookup"><span data-stu-id="d669f-170">Permission</span></span> | <span data-ttu-id="d669f-171">Entidade</span><span class="sxs-lookup"><span data-stu-id="d669f-171">Entity</span></span> | <span data-ttu-id="d669f-172">Solicitações com suporte</span><span class="sxs-lookup"><span data-stu-id="d669f-172">Supported requests</span></span> |
    |:----------|:-------|:-------------------|
    |<span data-ttu-id="d669f-173">SecurityActions.Read.All</span><span class="sxs-lookup"><span data-stu-id="d669f-173">SecurityActions.Read.All</span></span>| <span data-ttu-id="d669f-174">&bull; [securityActions](/graph/api/resources/securityaction?view=graph-rest-beta) (visualização)</span><span class="sxs-lookup"><span data-stu-id="d669f-174">&bull; [securityActions](/graph/api/resources/securityaction?view=graph-rest-beta) (preview)</span></span> | <span data-ttu-id="d669f-175">GET</span><span class="sxs-lookup"><span data-stu-id="d669f-175">GET</span></span> |
    |<span data-ttu-id="d669f-176">SecurityActions.ReadWrite.All</span><span class="sxs-lookup"><span data-stu-id="d669f-176">SecurityActions.ReadWrite.All</span></span>| <span data-ttu-id="d669f-177">&bull; [securityActions](/graph/api/resources/securityaction?view=graph-rest-beta) (visualização)</span><span class="sxs-lookup"><span data-stu-id="d669f-177">&bull; [securityActions](/graph/api/resources/securityaction?view=graph-rest-beta) (preview)</span></span> | <span data-ttu-id="d669f-178">GET, POST</span><span class="sxs-lookup"><span data-stu-id="d669f-178">GET, POST</span></span> |
    |<span data-ttu-id="d669f-179">SecurityEvents.Read.All</span><span class="sxs-lookup"><span data-stu-id="d669f-179">SecurityEvents.Read.All</span></span> | <span data-ttu-id="d669f-180">&bull; [alerts](/graph/api/resources/alert?view=graph-rest-1.0)</span><span class="sxs-lookup"><span data-stu-id="d669f-180">&bull; [alerts](/graph/api/resources/alert?view=graph-rest-1.0)</span></span></br> <span data-ttu-id="d669f-181">&bull; [secureScores](/graph/api/resources/securescores?view=graph-rest-beta)</span><span class="sxs-lookup"><span data-stu-id="d669f-181">&bull; [secureScores](/graph/api/resources/securescores?view=graph-rest-beta)</span></span> </br> <span data-ttu-id="d669f-182">&bull; [secureScoreControlProfiles](/graph/api/resources/securescorecontrolprofiles?view=graph-rest-beta)</span><span class="sxs-lookup"><span data-stu-id="d669f-182">&bull; [secureScoreControlProfiles](/graph/api/resources/securescorecontrolprofiles?view=graph-rest-beta)</span></span> | <span data-ttu-id="d669f-183">OBTER</span><span class="sxs-lookup"><span data-stu-id="d669f-183">GET</span></span> |
    |<span data-ttu-id="d669f-184">SecurityEvents.ReadWrite.All</span><span class="sxs-lookup"><span data-stu-id="d669f-184">SecurityEvents.ReadWrite.All</span></span> | <span data-ttu-id="d669f-185">&bull; [alerts](/graph/api/resources/alert?view=graph-rest-1.0)</span><span class="sxs-lookup"><span data-stu-id="d669f-185">&bull; [alerts](/graph/api/resources/alert?view=graph-rest-1.0)</span></span></br> <span data-ttu-id="d669f-186">&bull; [secureScores](/graph/api/resources/securescores?view=graph-rest-beta)</span><span class="sxs-lookup"><span data-stu-id="d669f-186">&bull; [secureScores](/graph/api/resources/securescores?view=graph-rest-beta)</span></span> </br> <span data-ttu-id="d669f-187">&bull; [secureScoreControlProfiles](/graph/api/resources/securescorecontrolprofiles?view=graph-rest-beta)</span><span class="sxs-lookup"><span data-stu-id="d669f-187">&bull; [secureScoreControlProfiles](/graph/api/resources/securescorecontrolprofiles?view=graph-rest-beta)</span></span> | <span data-ttu-id="d669f-188">GET, POST, PATCH</span><span class="sxs-lookup"><span data-stu-id="d669f-188">GET, POST, PATCH</span></span> |
    |<span data-ttu-id="d669f-189">ThreatIndicators.ReadWrite.OwnedBy</span><span class="sxs-lookup"><span data-stu-id="d669f-189">ThreatIndicators.ReadWrite.OwnedBy</span></span> | <span data-ttu-id="d669f-190">&bull; [tiIndicator](/graph/api/resources/tiindicator?view=graph-rest-beta) (visualização)</span><span class="sxs-lookup"><span data-stu-id="d669f-190">&bull; [tiIndicator](/graph/api/resources/tiindicator?view=graph-rest-beta) (preview)</span></span> | <span data-ttu-id="d669f-191">GET, POST, PATCH, DELETE</span><span class="sxs-lookup"><span data-stu-id="d669f-191">GET, POST, PATCH, DELETE</span></span>|

7. <span data-ttu-id="d669f-192">Selecione **Adicionar permissões**.</span><span class="sxs-lookup"><span data-stu-id="d669f-192">Choose **Add permissions**.</span></span>

<span data-ttu-id="d669f-193">Salve as informações a seguir:</span><span class="sxs-lookup"><span data-stu-id="d669f-193">Save the following information:</span></span>

- <span data-ttu-id="d669f-194">ID do aplicativo (cliente)</span><span class="sxs-lookup"><span data-stu-id="d669f-194">Application (client) ID</span></span>
- <span data-ttu-id="d669f-195">URL de redirecionamento</span><span class="sxs-lookup"><span data-stu-id="d669f-195">Redirect URL</span></span>
- <span data-ttu-id="d669f-196">Lista de permissões necessárias</span><span class="sxs-lookup"><span data-stu-id="d669f-196">List of required permissions</span></span>

<span data-ttu-id="d669f-197">\*A Proteção Avançada contra Ameaças do Windows Defender (WDATP) exige mais [funções de usuário](https://docs.microsoft.com/windows/security/threat-protection/microsoft-defender-atp/user-roles) do que as necessárias para a API de Segurança do Microsoft Graph; portanto, somente os usuários nas funções do WDATP e da API de Segurança do Microsoft Graph podem ter acesso aos dados do WDATP.</span><span class="sxs-lookup"><span data-stu-id="d669f-197">\* Windows Defender Advanced Threat Protection (WDATP) requires additional [user roles](https://docs.microsoft.com/windows/security/threat-protection/microsoft-defender-atp/user-roles) than what is required by the Microsoft Graph Security API; therefore, only the users in both WDATP and Microsoft Graph Security API roles can have access to the WDATP data.</span></span>  <span data-ttu-id="d669f-198">A autenticação somente para aplicativos não é limitada por isso. Portanto, recomendamos que você use um token de autenticação somente para aplicativos.</span><span class="sxs-lookup"><span data-stu-id="d669f-198">Application-only authentication is not limited by this; therefore, we recommend that you use an app-only authentication token.</span></span>

<span data-ttu-id="d669f-199">Para obter mais informações, consulte [Registrar um aplicativo na Plataforma de Identidade da Microsoft](auth-register-app-v2.md).</span><span class="sxs-lookup"><span data-stu-id="d669f-199">For more information, see [Register your app with the Microsoft identity platform](auth-register-app-v2.md).</span></span>

## <a name="grant-permissions-to-an-application"></a><span data-ttu-id="d669f-200">Conceder permissões a um aplicativo.</span><span class="sxs-lookup"><span data-stu-id="d669f-200">Grant permissions to an application</span></span>

<span data-ttu-id="d669f-201">O registro do aplicativo define somente qual permissão o aplicativo requer - ele não concede essas permissões ao aplicativo.</span><span class="sxs-lookup"><span data-stu-id="d669f-201">Application registration only defines which permission the application requires - it does not grant these permissions to the application.</span></span> <span data-ttu-id="d669f-202">Um administrador de locatários do Microsoft Azure AD deve conceder explicitamente essas permissões, fazendo uma chamada para o ponto de extremidade de consentimento do administrador.</span><span class="sxs-lookup"><span data-stu-id="d669f-202">An Azure AD tenant administrator must explicitly grant these permissions by making a call to the admin consent endpoint.</span></span> <span data-ttu-id="d669f-203">Para detalhes, consulte [Usando o ponto de extremidade de consentimento do administrador](https://docs.microsoft.com/azure/active-directory/develop/active-directory-v2-scopes#using-the-admin-consent-endpoint).</span><span class="sxs-lookup"><span data-stu-id="d669f-203">For details, see [Using the admin consent endpoint](https://docs.microsoft.com/azure/active-directory/develop/active-directory-v2-scopes#using-the-admin-consent-endpoint).</span></span>

<span data-ttu-id="d669f-204">Para conceder permissões a um aplicativo, você precisará:</span><span class="sxs-lookup"><span data-stu-id="d669f-204">To grant permissions to an application, you'll need:</span></span>

- <span data-ttu-id="d669f-205">**ID do Aplicativo** – ID do aplicativo do portal de registro do aplicativo Azure.</span><span class="sxs-lookup"><span data-stu-id="d669f-205">**Application ID** - The application ID from the Azure application registration portal.</span></span>
- <span data-ttu-id="d669f-206">**URL de redirecionamento** – Cadeia de caracteres que você define no portal de registro do aplicativo para resposta de autenticação.</span><span class="sxs-lookup"><span data-stu-id="d669f-206">**Redirect URL** - The string you set in the Azure application registration portal for authentication response.</span></span>

<span data-ttu-id="d669f-207">Para conceder as permissões:</span><span class="sxs-lookup"><span data-stu-id="d669f-207">To grant the permissions:</span></span>

- <span data-ttu-id="d669f-208">Em um editor de texto, crie a seguinte cadeia de caracteres de URL:</span><span class="sxs-lookup"><span data-stu-id="d669f-208">In a text editor, create the following URL string:</span></span>

    `https://login.microsoftonline.com/common/adminconsent?client_id=<Application Id>&state=12345&redirect_uri=<Redirect URL>`

- <span data-ttu-id="d669f-209">Em um navegador Web, acesse este URL e faça login como administrador de locatários.</span><span class="sxs-lookup"><span data-stu-id="d669f-209">In a web browser, go to this URL, and sign in as a tenant administrator.</span></span> <span data-ttu-id="d669f-210">A caixa de diálogo mostra a lista de permissões que o aplicativo requer, conforme especificado no portal de registro do aplicativo.</span><span class="sxs-lookup"><span data-stu-id="d669f-210">The dialog box shows the list of permission the application requires, as specified in the application registration portal.</span></span> <span data-ttu-id="d669f-211">Selecione **OK** para conceder ao aplicativo essas permissões.</span><span class="sxs-lookup"><span data-stu-id="d669f-211">Choose **OK** to grant the application these permissions.</span></span>

> <span data-ttu-id="d669f-212">**Observação:** Esta etapa concede permissões ao aplicativo - não aos usuários.</span><span class="sxs-lookup"><span data-stu-id="d669f-212">**Note:** This step grants permissions to the application - not to users.</span></span> <span data-ttu-id="d669f-213">Isso significa que todos os usuários pertencentes ao locatário do Microsoft Azure AD que usam esse aplicativo receberão essas permissões, inclusive usuários não administradores.</span><span class="sxs-lookup"><span data-stu-id="d669f-213">This means that all users belonging to the Azure AD tenant that use this application will be granted these permissions - even non-admin users.</span></span>

## <a name="assign-azure-ad-roles-to-users"></a><span data-ttu-id="d669f-214">Atribuir funções do Microsoft Azure AD aos usuários</span><span class="sxs-lookup"><span data-stu-id="d669f-214">Assign Azure AD roles to users</span></span>

<span data-ttu-id="d669f-215">Depois que um aplicativo receber permissões, todas as pessoas com acesso ao aplicativo (ou seja, membros do locatário do Azure AD) receberão as permissões concedidas.</span><span class="sxs-lookup"><span data-stu-id="d669f-215">After an application is granted permissions, everyone with access to the application (that is, members of the Azure AD tenant) will receive the granted permissions.</span></span> <span data-ttu-id="d669f-216">Para proteger ainda mais os dados confidenciais de segurança, a API de Segurança do Microsoft Graph também exige que os usuários recebam a função **Leitor de segurança** do Microsoft Azure AD.</span><span class="sxs-lookup"><span data-stu-id="d669f-216">To further protect sensitive security data, the Microsoft Graph Security API also requires users to be assigned the Azure AD **Security Reader** role.</span></span> <span data-ttu-id="d669f-217">Para obter detalhes, confira [Permissões da função de administrador no Azure Active Directory](https://docs.microsoft.com/azure/active-directory/active-directory-assign-admin-roles-azure-portal) e [Atribuir funções de administrador e não-administrador aos usuários com o Azure Active Directory](https://docs.microsoft.com/azure/active-directory/active-directory-users-assign-role-azure-portal).</span><span class="sxs-lookup"><span data-stu-id="d669f-217">For details, see [Administrator role permissions in Azure Active Directory](https://docs.microsoft.com/azure/active-directory/active-directory-assign-admin-roles-azure-portal) and [Assign administrator and non-administrator roles to users with Azure Active Directory](https://docs.microsoft.com/azure/active-directory/active-directory-users-assign-role-azure-portal).</span></span>

><span data-ttu-id="d669f-218">**Observação:** Você precisa ser um administrador de locatários para executar esta etapa.</span><span class="sxs-lookup"><span data-stu-id="d669f-218">**Note:** You must be a tenant admin to perform this step.</span></span>

<span data-ttu-id="d669f-219">Para atribuir uma função a um usuário:</span><span class="sxs-lookup"><span data-stu-id="d669f-219">To assign an RBAC role to a user</span></span>

1. <span data-ttu-id="d669f-220">Entre no [portal do Azure](https://portal.azure.com) (https://portal.azure.com).</span><span class="sxs-lookup"><span data-stu-id="d669f-220">Sign in to the [Azure portal](https://portal.azure.com) (https://portal.azure.com).</span></span>
2. <span data-ttu-id="d669f-221">Clique no ícone no canto superior esquerdo para expandir o menu do portal do Azure.</span><span class="sxs-lookup"><span data-stu-id="d669f-221">Click the icon in the top left to expand the Azure portal menu.</span></span> <span data-ttu-id="d669f-222">Selecione **Azure Active Directory** > **Usuários**.</span><span class="sxs-lookup"><span data-stu-id="d669f-222">Select **Azure Active Directory**.</span></span>
3. <span data-ttu-id="d669f-223">Clique no nome do usuário.</span><span class="sxs-lookup"><span data-stu-id="d669f-223">Click the name of the user to open the user's property information.</span></span>
4. <span data-ttu-id="d669f-224">Escolha **Funções atribuídas** e, em seguida, **Adicionar atribuição**.</span><span class="sxs-lookup"><span data-stu-id="d669f-224">Choose **Assigned roles**, and then **Add assignment**.</span></span>
5. <span data-ttu-id="d669f-225">Selecione **Leitor de segurança** e clique em **Adicionar**.</span><span class="sxs-lookup"><span data-stu-id="d669f-225">Select **Security reader**, and click **Add**.</span></span>

## <a name="create-an-authentication-code"></a><span data-ttu-id="d669f-226">Crie um código de autenticação</span><span class="sxs-lookup"><span data-stu-id="d669f-226">Create an authentication code</span></span>

<span data-ttu-id="d669f-227">Para criar um código de autenticação, você precisará de:</span><span class="sxs-lookup"><span data-stu-id="d669f-227">To create an authentication code, you'll need:</span></span>

- <span data-ttu-id="d669f-228">**ID do Aplicativo** - a ID do aplicativo do portal de registro do aplicativo.</span><span class="sxs-lookup"><span data-stu-id="d669f-228">**Application ID** - The application ID from application registration portal.</span></span>
- <span data-ttu-id="d669f-229">**URL de redirecionamento** - o URL no qual a resposta de autenticação do Microsoft Azure AD é enviada.</span><span class="sxs-lookup"><span data-stu-id="d669f-229">**Redirect URL** - The URL where the authentication response from Azure AD is sent.</span></span> <span data-ttu-id="d669f-230">Para começar, você pode usar https://localhost ou a homepage do aplicativo Web do cliente de teste.</span><span class="sxs-lookup"><span data-stu-id="d669f-230">To start, you can use https://localhost or the test client web app homepage.</span></span>
- <span data-ttu-id="d669f-231">**Chave do aplicativo** (opcional) - a chave do aplicativo.</span><span class="sxs-lookup"><span data-stu-id="d669f-231">**Application Key** (optional) - The key of the application.</span></span> <span data-ttu-id="d669f-232">Isso se aplica quando você está desenvolvendo um aplicativo que usará somente o código de autenticação do aplicativo (ou seja, não oferecerá suporte à autenticação delegada pelo usuário).</span><span class="sxs-lookup"><span data-stu-id="d669f-232">This applies when you're developing an application that will use application-only authentication code (that is, will not support user delegated authentication).</span></span>

<span data-ttu-id="d669f-233">A tabela a seguir lista os recursos que você pode usar para criar um código de autenticação.</span><span class="sxs-lookup"><span data-stu-id="d669f-233">The following table lists resources that you can use to create an authentication code.</span></span>

|<span data-ttu-id="d669f-234">**Tipo de aplicativo**</span><span class="sxs-lookup"><span data-stu-id="d669f-234">**Type of application**</span></span>|<span data-ttu-id="d669f-235">**Biblioteca de autenticação**</span><span class="sxs-lookup"><span data-stu-id="d669f-235">**Authentication library**</span></span>|
|------------------------|----------------------------|
|[<span data-ttu-id="d669f-236">Aplicativos da área de trabalho, iOS</span><span class="sxs-lookup"><span data-stu-id="d669f-236">Desktop apps - iOS</span></span>](https://docs.microsoft.com/azure/active-directory/develop/guidedsetups/active-directory-ios)|[<span data-ttu-id="d669f-237">MSAL.framework: Visualização da Biblioteca de Autenticação da Microsoft para iOS</span><span class="sxs-lookup"><span data-stu-id="d669f-237">MSAL.framework: Microsoft Authentication Library Preview for iOS</span></span>](https://github.com/AzureAD/microsoft-authentication-library-for-objc)|
|[<span data-ttu-id="d669f-238">Aplicativos da área de trabalho - Android</span><span class="sxs-lookup"><span data-stu-id="d669f-238">Desktop apps - Android</span></span>](https://docs.microsoft.com/azure/active-directory/develop/guidedsetups/active-directory-android)|[<span data-ttu-id="d669f-239">Biblioteca de Autenticação Microsoft (MSAL)</span><span class="sxs-lookup"><span data-stu-id="d669f-239">Microsoft Authentication Library (MSAL)</span></span>](https://javadoc.io/doc/com.microsoft.identity.client/msal)|
|[<span data-ttu-id="d669f-240">Aplicativos da área de trabalho - .Net</span><span class="sxs-lookup"><span data-stu-id="d669f-240">Desktop apps - .Net</span></span>](https://docs.microsoft.com/azure/active-directory/develop/guidedsetups/active-directory-windesktop)|[<span data-ttu-id="d669f-241">Biblioteca de Autenticação Microsoft (MSAL)</span><span class="sxs-lookup"><span data-stu-id="d669f-241">Microsoft Authentication Library (MSAL)</span></span>](https://www.nuget.org/packages/Microsoft.Identity.Client)|
|[<span data-ttu-id="d669f-242">Aplicativos Web - JavaScript SPA</span><span class="sxs-lookup"><span data-stu-id="d669f-242">Web apps - JavaScript SPA</span></span>](https://docs.microsoft.com/azure/active-directory/develop/guidedsetups/active-directory-javascriptspa)|[<span data-ttu-id="d669f-243">Biblioteca de autenticação da Microsoft para visualização de JavaScript</span><span class="sxs-lookup"><span data-stu-id="d669f-243">Microsoft Authentication Library for JavaScript Preview</span></span>](https://github.com/AzureAD/microsoft-authentication-library-for-js)|
|[<span data-ttu-id="d669f-244">Aplicativos Web - Servidor Web .NET</span><span class="sxs-lookup"><span data-stu-id="d669f-244">Web apps - .NET Web Server</span></span>](https://docs.microsoft.com/azure/active-directory/develop/guidedsetups/active-directory-aspnetwebapp)|<span data-ttu-id="d669f-245">OpenIdConnection, Cookies, SystemWeb</span><span class="sxs-lookup"><span data-stu-id="d669f-245">OpenIdConnection, Cookies, SystemWeb</span></span>|
|[<span data-ttu-id="d669f-246">Aplicativos Web - Aplicativo da Web NodeJS</span><span class="sxs-lookup"><span data-stu-id="d669f-246">Web apps - NodeJS Web App</span></span>](https://docs.microsoft.com/azure/active-directory/develop/active-directory-v2-devquickstarts-node-web)||

<span data-ttu-id="d669f-247">Para aplicativos que não usam nenhuma das bibliotecas existentes, consulte [Obter acesso em nome de um usuário](auth-v2-user.md).</span><span class="sxs-lookup"><span data-stu-id="d669f-247">For applications that don't use any of the existing libraries, see [Get access on behalf of a user](auth-v2-user.md).</span></span>

1. <span data-ttu-id="d669f-248">Obter um código do Microsoft Azure AD.</span><span class="sxs-lookup"><span data-stu-id="d669f-248">Get a code from Azure AD.</span></span> <span data-ttu-id="d669f-249">A consulta a ser chamada contém o parâmetro para a ID do aplicativo, o URL de redirecionamento e as **permissões necessárias**.</span><span class="sxs-lookup"><span data-stu-id="d669f-249">The query to call contains parameter for Application ID, Redirect URl, and **required permissions**.</span></span>
2. <span data-ttu-id="d669f-250">Use o código para obter um token de acesso.</span><span class="sxs-lookup"><span data-stu-id="d669f-250">Use the code to get an access token.</span></span>

<span data-ttu-id="d669f-251">Se você usa a biblioteca OpenId Connect, consulte [Autenticar usando o Microsoft Azure AD e OpenID Connect](https://docs.microsoft.com/azure/architecture/multitenant-identity/authenticate) e ligar`app.UseOpenIdConnectAuthentication()`.</span><span class="sxs-lookup"><span data-stu-id="d669f-251">If you use OpenId Connect library, see [Authenticate using Azure AD and OpenID Connect](https://docs.microsoft.com/azure/architecture/multitenant-identity/authenticate) and call `app.UseOpenIdConnectAuthentication()`.</span></span>

><span data-ttu-id="d669f-252">**Observação:** Se você estiver solicitando tokens de autenticação delegada pelo usuário, o parâmetro da biblioteca será **Escopos solicitados**.</span><span class="sxs-lookup"><span data-stu-id="d669f-252">**Note:** If you're requesting user delegated authentication tokens, the parameter for the library is **Requested Scopes**.</span></span> <span data-ttu-id="d669f-253">Use o User.Read para este parâmetro ao invés do que o aplicativo registrado solicitar.</span><span class="sxs-lookup"><span data-stu-id="d669f-253">Use User.Read for this parameter instead of what the registered application requires.</span></span> <span data-ttu-id="d669f-254">O parâmetro **Escopos solicitados** NÃO afeta as permissões contidas nos tokens de autenticação retornados.</span><span class="sxs-lookup"><span data-stu-id="d669f-254">The **Requested Scopes** parameter does NOT affect the permissions contained in the returned authentication tokens.</span></span> <span data-ttu-id="d669f-255">Estes são determinados pelas permissões que o administrador de locatários concedeu ao aplicativo.</span><span class="sxs-lookup"><span data-stu-id="d669f-255">These are determined by the permissions that the tenant admin granted the application.</span></span>

<span data-ttu-id="d669f-256">Por exemplo, se você estiver usando a biblioteca MSAL do .NET, chame o seguinte:</span><span class="sxs-lookup"><span data-stu-id="d669f-256">For example, if you're using the .NET MSAL library, call the following:</span></span>

`var accessToken = (await client.AcquireTokenAsync(scopes)).AccessToken;`

><span data-ttu-id="d669f-257">**Observação:** Este exemplo deve usar a permissão menos privilegiada, como User.Read.</span><span class="sxs-lookup"><span data-stu-id="d669f-257">**Note:** This example should use the least privileged permission, such as User.Read.</span></span> <span data-ttu-id="d669f-258">No entanto, o token de acesso retornado pode conter permissões que foram concedidas pelo administrador locatário para o locatário do usuário atual, como User.Read.All ou User.ReadWrite.All.</span><span class="sxs-lookup"><span data-stu-id="d669f-258">However, the returned access token can contain permissions that were granted by the tenant admin for the current user tenant, such as User.Read.All or User.ReadWrite.All.</span></span>

<span data-ttu-id="d669f-259">Um token (cadeia de caracteres) é retornado pelo Microsoft Azure AD que contém informações de autenticação e as permissões necessárias para o aplicativo.</span><span class="sxs-lookup"><span data-stu-id="d669f-259">A token (string) is returned by Azure AD that contains your authentication information and the permissions required by the application.</span></span> <span data-ttu-id="d669f-260">Atribua esse token ao cabeçalho HTTP como um token de portador, conforme mostrado no exemplo a seguir.</span><span class="sxs-lookup"><span data-stu-id="d669f-260">Assign this token to the HTTP header as a bearer token, as shown in the following example.</span></span>

`request.Headers.Authorization = new AuthenticationHeaderValue("bearer", accessToken);`

<span data-ttu-id="d669f-261">O Microsoft Graph validará as informações contidas nesse token e concederá ou rejeitará o acesso.</span><span class="sxs-lookup"><span data-stu-id="d669f-261">Microsoft Graph will validate the information contained in this token and grant, or reject, access.</span></span>

<span data-ttu-id="d669f-262">Para visualizar as declarações contidas no token retornado, use a biblioteca do NuGet System.IdentityModel.Tokens.Jwt.</span><span class="sxs-lookup"><span data-stu-id="d669f-262">To view claims contained in the returned token, use NuGet library System.IdentityModel.Tokens.Jwt.</span></span>

`JwtSecurityTokenHandler tokenHandler = new JwtSecurityTokenHandler();`</br>
`var securityToken = tokenHandler.ReadToken(accessToken) as JwtSecurityToken;`

<span data-ttu-id="d669f-263">A resposta do Microsoft Graph contém um cabeçalho chamado client-request-id, que é um GUID.</span><span class="sxs-lookup"><span data-stu-id="d669f-263">The response from Microsoft Graph contains a header called client-request-id, which is a GUID.</span></span> <span data-ttu-id="d669f-264">Se o acesso for negado, especifique esse GUID ao procurar suporte na [Microsoft Tech Community](https://techcommunity.microsoft.com/t5/Microsoft-Graph-Security-API/ct-p/SecurityGraphAPI), para que possamos ajudar a investigar a causa dessa falha de autenticação.</span><span class="sxs-lookup"><span data-stu-id="d669f-264">If access is denied, please specify this GUID when seeking support at [Microsoft Tech Community](https://techcommunity.microsoft.com/t5/Microsoft-Graph-Security-API/ct-p/SecurityGraphAPI), so we can help investigate the cause of this authentication failure.</span></span>
