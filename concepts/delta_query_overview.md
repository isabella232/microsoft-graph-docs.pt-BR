#  <a name="use-delta-query-to-track-changes-in-microsoft-graph-data"></a><span data-ttu-id="adf50-101">Usar a consulta delta para controlar alterações nos dados do Microsoft Graph</span><span class="sxs-lookup"><span data-stu-id="adf50-101">Use delta query to track changes in Microsoft Graph data</span></span>

<span data-ttu-id="adf50-p101">A consulta delta permite que aplicativos localizem entidades recém-criadas, atualizadas ou excluídas sem executar uma leitura completa do recurso de destino com cada solicitação. Os aplicativos do Microsoft Graph podem usar consulta delta para sincronizar, com eficiência, alterações com armazenamento de dados local.</span><span class="sxs-lookup"><span data-stu-id="adf50-p101">Delta query enables applications to discover newly created, updated, or deleted entities without performing a full read of the target resource with every request. Microsoft Graph applications can use delta query to efficiently synchronize changes with a local data store.</span></span>

## <a name="use-delta-query-to-track-changes-in-a-resource-collection"></a><span data-ttu-id="adf50-104">Usar solicitação delta para rastrear alterações em uma coleção resource</span><span class="sxs-lookup"><span data-stu-id="adf50-104">Use delta query to track changes in a resource collection</span></span>

<span data-ttu-id="adf50-105">O padrão típico de chamada corresponde ao que segue:</span><span class="sxs-lookup"><span data-stu-id="adf50-105">The typical call pattern is as follows:</span></span>

1.  <span data-ttu-id="adf50-106">O aplicativo começa chamando uma solicitação GET com a função delta no recurso desejado.</span><span class="sxs-lookup"><span data-stu-id="adf50-106">The application begins by calling a GET request with the delta function on the desired resource.</span></span>
2.  <span data-ttu-id="adf50-107">O Microsoft Graph envia uma resposta que contém o recurso solicitado e um [token de estado](#state-tokens).</span><span class="sxs-lookup"><span data-stu-id="adf50-107">Microsoft Graph sends a response containing the requested resource and a [state token](#state-tokens).</span></span>

     <span data-ttu-id="adf50-p102">a.  Se uma URL `nextLink` é retornada, poderá haver páginas de dados adicionais a serem recuperadas na sessão. O aplicativo continua fazendo solicitações usando a URL `nextLink` para recuperar todas as páginas de dados até que uma URL `deltaLink` seja retornada na resposta.</span><span class="sxs-lookup"><span data-stu-id="adf50-p102">a.  If a `nextLink` URL is returned, there may be additional pages of data to be retrieved in the session. The application continues making requests using the `nextLink` URL to retrieve all pages of data until a `deltaLink` URL is returned in the response.</span></span>

     <span data-ttu-id="adf50-p103">b.  Se uma URL `deltaLink` é retornada, não há mais nenhum dado sobre o estado do recurso a ser retornado. Em solicitações futuras, o aplicativo usa a URL `deltaLink` para inteirar-se das alterações feitas no recurso.</span><span class="sxs-lookup"><span data-stu-id="adf50-p103">b.  If a `deltaLink` URL is returned, there is no more data about the existing state of the resource to be returned. For future requests, the application uses the `deltaLink` URL to learn about changes to the resource.</span></span>
     
3.  <span data-ttu-id="adf50-p104">Quando o aplicativo precisa saber das alterações no recurso, ele faz uma nova solicitação usando a URL `deltaLink` recebida na etapa 2. Esta solicitação *pode* ser feita imediatamente após concluir a etapa 2 ou quando o aplicativo verifica as alterações.</span><span class="sxs-lookup"><span data-stu-id="adf50-p104">When the application needs to learn about changes to the resource, it makes a new request using the `deltaLink` URL received in step 2. This request *may* be made immediately after completing step 2 or when the application checks for changes.</span></span>
4.  <span data-ttu-id="adf50-116">O Microsoft Graph retorna uma resposta descrevendo alterações no recurso desde a solicitação anterior e em uma URL `nextLink` ou uma URL `deltaLink`.</span><span class="sxs-lookup"><span data-stu-id="adf50-116">Microsoft Graph returns a response describing changes to the resource since the previous request, and either a `nextLink` URL or a `deltaLink` URL.</span></span>

### <a name="state-tokens"></a><span data-ttu-id="adf50-117">Tokens de estado</span><span class="sxs-lookup"><span data-stu-id="adf50-117">State tokens</span></span>

<span data-ttu-id="adf50-p105">Um GET de consulta delta sempre inclui uma URL especificada em um cabeçalho de resposta `nextLink` ou `deltaLink`. A URL `nextLink` inclui um _skipToken_ e uma URL `deltaLink` inclui um _deltaToken_.</span><span class="sxs-lookup"><span data-stu-id="adf50-p105">A delta query GET response always includes a URL specified in a `nextLink` or `deltaLink` response header. The `nextLink` URL includes a _skipToken_, and a `deltaLink` URL includes a _deltaToken_.</span></span> 

<span data-ttu-id="adf50-p106">Esses tokens são opacos para o cliente. Os seguintes detalhes são o que você precisa saber sobre eles:</span><span class="sxs-lookup"><span data-stu-id="adf50-p106">These tokens are opaque to the client. The following details are what you need to know about them:</span></span>

- <span data-ttu-id="adf50-122">Cada token reflete o estado e representa um instantâneo do recurso dessa fase do rastreamento de alterações.</span><span class="sxs-lookup"><span data-stu-id="adf50-122">Each token reflects the state and represents a snapshot of the resource in that round of change tracking.</span></span> 
- <span data-ttu-id="adf50-p107">Os tokens de estado também codificam e incluem outros parâmetros da consulta (como `$select`) especificados na solicitação de consulta delta inicial. Portanto, ele não é necessário repeti-los em solicitações de consulta delta subsequentes.</span><span class="sxs-lookup"><span data-stu-id="adf50-p107">The state tokens also encode and include other query parameters (such as `$select`) specified in the initial delta query request. Therefore, it's not required to repeat them in subsequent delta query requests.</span></span>
- <span data-ttu-id="adf50-125">Ao realizar a consulta delta, você pode copiar e aplicar a URL `nextLink` ou `deltaLink` à próxima chamada de função **delta** sem precisar inspecionar o conteúdo da URL, incluindo seu token de estado.</span><span class="sxs-lookup"><span data-stu-id="adf50-125">When carrying out delta query, you can copy and apply the `nextLink` or `deltaLink` URL to the next **delta** function call without having to inspect the contents of the URL, including its state token.</span></span>


### <a name="optional-query-parameters"></a><span data-ttu-id="adf50-126">Parâmetros de consulta opcionais</span><span class="sxs-lookup"><span data-stu-id="adf50-126">Optional query parameters</span></span>

<span data-ttu-id="adf50-p108">Se um cliente usa um parâmetro de consulta, ele deve ser especificado na solicitação inicial. O Microsoft Graph codifica automaticamente o parâmetro especificado nos parâmetros `nextLink` ou `deltaLink` fornecidos na resposta. O aplicativo de chamada só precisa especificar os parâmetros de consulta desejados uma vez antecipados. O Microsoft Graph adiciona os parâmetros especificados automaticamente para todas as solicitações subsequentes.</span><span class="sxs-lookup"><span data-stu-id="adf50-p108">If a client uses a query parameter, it must be specified in the initial request. Microsoft Graph automatically encodes the specified parameter into the `nextLink` or `deltaLink` provided in the response. The calling application only needs to specify their desired query parameters once upfront. Microsoft Graph adds the specified parameters automatically for all subsequent requests.</span></span>

<span data-ttu-id="adf50-131">Para usuários e grupos, existem restrições sobre como usar alguns parâmetros de consulta:</span><span class="sxs-lookup"><span data-stu-id="adf50-131">For users and groups, there are restrictions on using some query parameters:</span></span>

-   <span data-ttu-id="adf50-p109">Se um parâmetro de consulta `$select` for usado, isso indica que o cliente prefere somente controlar alterações nas propriedades ou relações especificadas na instrução `$select`. Se ocorrer uma alteração em uma propriedade que não esteja selecionada, o recurso por meio do qual essa propriedade foi alterada não aparecerá na resposta delta após uma solicitação subsequente.</span><span class="sxs-lookup"><span data-stu-id="adf50-p109">If a `$select` query parameter is used, the parameter indicates that the client prefers to only track changes on the properties or relationships specified in the `$select` statement. If a change occurs to a property that is not selected, the resource for which that property changed does not appear in the delta response after a subsequent request.</span></span>
-   <span data-ttu-id="adf50-134">Não há suporte para `$expand`.</span><span class="sxs-lookup"><span data-stu-id="adf50-134">`$expand` is not supported.</span></span>

<span data-ttu-id="adf50-p110">Nas APIs de usuários e grupos beta (prévia), os filtros de escopo permitem controlar alterações para um ou mais usuários ou grupos específicos por objectId. Por exemplo, a seguinte solicitação: https://graph.microsoft.com/beta/groups/delta/?$filter= id eq '477e9fc6-5de7-4406-bb2a-7e5c83c9ae5f' or id eq '004d6a07-fe70-4b92-add5-e6e37b8acd8e' retorna alterações dos grupos que correspondem às IDs especificadas no filtro de consulta.</span><span class="sxs-lookup"><span data-stu-id="adf50-p110">For users and groups beta (preview) APIs, scoping filters allow you to track changes to one or more specific users or groups by objectId. For example, the following request: https://graph.microsoft.com/beta/groups/delta/?$filter= id eq '477e9fc6-5de7-4406-bb2a-7e5c83c9ae5f' or id eq '004d6a07-fe70-4b92-add5-e6e37b8acd8e' returns changes for the groups matching the ids specified in the query filter.</span></span> 

## <a name="resource-representation-in-the-delta-query-response"></a><span data-ttu-id="adf50-137">Representação de recurso na resposta da consulta delta</span><span class="sxs-lookup"><span data-stu-id="adf50-137">Resource representation in the delta query response</span></span>

-   <span data-ttu-id="adf50-138">Instâncias de um recurso recém-criadas de um recurso para o qual há suporte são representadas na resposta da consulta delta usando sua representação-padrão.</span><span class="sxs-lookup"><span data-stu-id="adf50-138">Newly created instances of a supported resource are represented in the delta query response using their standard representation.</span></span>

-   <span data-ttu-id="adf50-139">Instâncias atualizadas são representadas por seus **id** com *pelo menos* as propriedades que foram atualizadas, mas podem ser incluídas propriedades adicionais.</span><span class="sxs-lookup"><span data-stu-id="adf50-139">Updated instances are represented by their **id** with *at least* the properties that have been updated, but additional properties may be included.</span></span>

-   <span data-ttu-id="adf50-p111">Relações entre os usuários e os grupos são representadas como anotações na representação do recurso padrão. Essas anotações usam o formato `propertyName@delta`. As anotações são incluídas na resposta da solicitação de consulta inicial delta.</span><span class="sxs-lookup"><span data-stu-id="adf50-p111">Relationships on users and groups are represented as annotations on the standard resource representation. These annotations use the format `propertyName@delta`. The annotations are included in the response of the initial delta query request.</span></span>

<span data-ttu-id="adf50-p112">As instâncias removidas são representadas por sua **id** e um objeto `@removed`. O objeto `@removed` pode incluir informações adicionais sobre o porquê de a instância ter sido removida. Por exemplo,  "@removed": {"reason": “changed”}.</span><span class="sxs-lookup"><span data-stu-id="adf50-p112">Removed instances are represented by their **id** and an `@removed` object. The `@removed` object may include additional information about why the instance was removed. For example,  "@removed": {"reason": “changed”}.</span></span>

<span data-ttu-id="adf50-146">Possíveis motivos @removed podem ser *changed* ou *deleted*.</span><span class="sxs-lookup"><span data-stu-id="adf50-146">Possible @removed reasons can be *changed* or *deleted*.</span></span>
- <span data-ttu-id="adf50-147">*Alterado* indica que o item foi excluído e poderá ser restaurado de [deletedItems](../api-reference/beta/resources/directory.md).</span><span class="sxs-lookup"><span data-stu-id="adf50-147">*Changed* indicates the item was deleted and can be restored from [deletedItems](../api-reference/beta/resources/directory.md).</span></span>
- <span data-ttu-id="adf50-148">*Deleted* indica que o item foi excluído e não pode ser restaurado.</span><span class="sxs-lookup"><span data-stu-id="adf50-148">*Deleted* indicates the item is deleted and cannot be restored.</span></span>

<span data-ttu-id="adf50-p113">O objeto @removed pode ser retornado na resposta da consulta delta inicial e em respostas controladas (deltaLink). Os clientes que usam solicitações de consulta delta devem ser projetados para lidar com esses objetos nas respostas.</span><span class="sxs-lookup"><span data-stu-id="adf50-p113">@removed object can be returned in the initial delta query response and in tracked (deltaLink) responses. Clients using delta query requests should be designed to handle these object in the responses.</span></span>

## <a name="supported-resources"></a><span data-ttu-id="adf50-151">Recursos com suporte</span><span class="sxs-lookup"><span data-stu-id="adf50-151">Supported resources</span></span>

<span data-ttu-id="adf50-152">A consulta Delta é compatível atualmente com os seguintes recursos:</span><span class="sxs-lookup"><span data-stu-id="adf50-152">Delta query is currently supported for the following resources:</span></span>

| <span data-ttu-id="adf50-153">**Coleção de recursos**</span><span class="sxs-lookup"><span data-stu-id="adf50-153">**Resource collection**</span></span> | <span data-ttu-id="adf50-154">**API**</span><span class="sxs-lookup"><span data-stu-id="adf50-154">**API**</span></span> |
|:------ | :------ |
| <span data-ttu-id="adf50-155">Eventos em um modo de exibição de calendário (intervalo de datas) do calendário principal</span><span class="sxs-lookup"><span data-stu-id="adf50-155">Events in a calendar view (date range) of the primary calendar</span></span> | <span data-ttu-id="adf50-156">função [delta](../api-reference/v1.0/api/event_delta.md) do recurso [evento](../api-reference/v1.0/resources/event.md)</span><span class="sxs-lookup"><span data-stu-id="adf50-156">[delta](../api-reference/v1.0/api/event_delta.md) function of the [event](../api-reference/v1.0/resources/event.md) resource</span></span> |
| <span data-ttu-id="adf50-157">Grupos</span><span class="sxs-lookup"><span data-stu-id="adf50-157">Groups</span></span> | <span data-ttu-id="adf50-158">Função [delta](../api-reference/v1.0/api/group_delta.md) do recurso [group](../api-reference/v1.0/resources/group.md)</span><span class="sxs-lookup"><span data-stu-id="adf50-158">[delta](../api-reference/v1.0/api/group_delta.md) function of the [group](../api-reference/v1.0/resources/group.md) resource</span></span> |
| <span data-ttu-id="adf50-159">Pastas de email</span><span class="sxs-lookup"><span data-stu-id="adf50-159">Mail folders</span></span> | <span data-ttu-id="adf50-160">função [delta](../api-reference/v1.0/api/mailfolder_delta.md) do recurso [mailFolder](../api-reference/v1.0/resources/mailFolder.md) </span><span class="sxs-lookup"><span data-stu-id="adf50-160">[delta](../api-reference/v1.0/api/mailfolder_delta.md) function of the [mailFolder](../api-reference/v1.0/resources/mailFolder.md) resource</span></span> |
| <span data-ttu-id="adf50-161">Mensagens de uma pasta</span><span class="sxs-lookup"><span data-stu-id="adf50-161">Messages in a folder</span></span> | <span data-ttu-id="adf50-162">função [delta](../api-reference/v1.0/api/message_delta.md) do recurso [mensagem](../api-reference/v1.0/resources/message.md) </span><span class="sxs-lookup"><span data-stu-id="adf50-162">[delta](../api-reference/v1.0/api/message_delta.md) function of the [message](../api-reference/v1.0/resources/message.md) resource</span></span> | 
| <span data-ttu-id="adf50-163">Pastas de contatos pessoais</span><span class="sxs-lookup"><span data-stu-id="adf50-163">Personal contact folders</span></span> | <span data-ttu-id="adf50-164">função [delta](../api-reference/v1.0/api/contactfolder_delta.md) do recurso [contactFolder](../api-reference/v1.0/resources/contactfolder.md)</span><span class="sxs-lookup"><span data-stu-id="adf50-164">[delta](../api-reference/v1.0/api/contactfolder_delta.md) function of the [contactFolder](../api-reference/v1.0/resources/contactfolder.md) resource</span></span> |
| <span data-ttu-id="adf50-165">Contatos pessoais em uma pasta</span><span class="sxs-lookup"><span data-stu-id="adf50-165">Personal contacts in a folder</span></span> | <span data-ttu-id="adf50-166">função [delta](../api-reference/v1.0/api/contact_delta.md) do recurso [contato](../api-reference/v1.0/resources/contact.md)</span><span class="sxs-lookup"><span data-stu-id="adf50-166">[delta](../api-reference/v1.0/api/contact_delta.md) function of the [contact](../api-reference/v1.0/resources/contact.md) resource</span></span> |
| <span data-ttu-id="adf50-167">Usuários</span><span class="sxs-lookup"><span data-stu-id="adf50-167">Users</span></span> | <span data-ttu-id="adf50-168">função [delta](../api-reference/v1.0/api/user_delta.md) do recurso [usuário](../api-reference/v1.0/resources/user.md)</span><span class="sxs-lookup"><span data-stu-id="adf50-168">[delta](../api-reference/v1.0/api/user_delta.md) function of the [user](../api-reference/v1.0/resources/user.md) resource</span></span> | 
| <span data-ttu-id="adf50-169">Itens de unidade\*</span><span class="sxs-lookup"><span data-stu-id="adf50-169">Drive items\*</span></span> | <span data-ttu-id="adf50-170">Função [delta](../api-reference/v1.0/api/driveitem_delta.md) do recurso [driveItem](../api-reference/v1.0/resources/driveitem.md)</span><span class="sxs-lookup"><span data-stu-id="adf50-170">[delta](../api-reference/v1.0/api/driveitem_delta.md) function of the [driveItem](../api-reference/v1.0/resources/driveitem.md) resource</span></span> |


> <span data-ttu-id="adf50-p114">\* O padrão de uso dos recursos do OneDrive é semelhante a outros recursos compatíveis com algumas diferenças secundárias de sintaxe. A consulta delta para unidades será atualizada no futuro para serem consistentes com outros tipos de recursos. Para obter mais detalhes sobre a sintaxe atual, veja: <https://developer.microsoft.com/en-us/graph/docs/api-reference/v1.0/api/item_delta></span><span class="sxs-lookup"><span data-stu-id="adf50-p114">\* The usage pattern for OneDrive resources is similar to the other supported resources with some minor syntax differences. Delta query for drives will be updated in the future to be consistent with other resource types. For more detail about the current syntax, please see: <https://developer.microsoft.com/en-us/graph/docs/api-reference/v1.0/api/item_delta></span></span>

## <a name="prerequisites"></a><span data-ttu-id="adf50-174">Pré-requisitos</span><span class="sxs-lookup"><span data-stu-id="adf50-174">Prerequisites</span></span>

<span data-ttu-id="adf50-175">As mesmas [permissões](./permissions_reference.md) necessárias para ler um recurso específico também são necessárias para executar a consulta delta nesse recurso.</span><span class="sxs-lookup"><span data-stu-id="adf50-175">The same [permissions](./permissions_reference.md) that are required to read a specific resource are also required to perform delta query on that resource.</span></span>

## <a name="delta-query-request-examples"></a><span data-ttu-id="adf50-176">Exemplos de solicitação de consulta delta</span><span class="sxs-lookup"><span data-stu-id="adf50-176">Delta query request examples</span></span> 

- [<span data-ttu-id="adf50-177">Obter as alterações incrementais para os eventos em um modo de exibição de calendário</span><span class="sxs-lookup"><span data-stu-id="adf50-177">Get incremental changes to events in a calendar view</span></span>](../concepts/delta_query_events.md)
- [<span data-ttu-id="adf50-178">Obter as alterações incrementais para as mensagens em uma pasta</span><span class="sxs-lookup"><span data-stu-id="adf50-178">Get incremental changes to messages in a folder</span></span>](./delta_query_messages.md)
- [<span data-ttu-id="adf50-179">Obter as alterações incrementais para grupos</span><span class="sxs-lookup"><span data-stu-id="adf50-179">Get incremental changes to groups</span></span>](./delta_query_groups.md)
- [<span data-ttu-id="adf50-180">Obter as alterações incrementais para usuários</span><span class="sxs-lookup"><span data-stu-id="adf50-180">Get incremental changes to users</span></span>](./delta_query_users.md)
