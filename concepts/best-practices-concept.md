# <a name="best-practices-for-working-with-microsoft-graph"></a><span data-ttu-id="e1a38-101">Práticas recomendadas para trabalhar com o Microsoft Graph</span><span class="sxs-lookup"><span data-stu-id="e1a38-101">Best practices for working with Microsoft Graph</span></span>

<span data-ttu-id="e1a38-102">Este artigo descreve as práticas recomendadas que você pode aplicar para ajudar seus aplicativos a tirar o máximo proveito do Microsoft Graph, caso isso envolva saber mais sobre o Microsoft Graph, melhorar o desempenho do aplicativo ou tornar seu aplicativo mais confiável para os usuários finais.</span><span class="sxs-lookup"><span data-stu-id="e1a38-102">This article describes best practices that you can apply to help your applications get the most out of Microsoft Graph - whether that involves learning about Microsoft Graph, improving app performance, or making your application more reliable for end users.</span></span>

## <a name="use-graph-explorer-to-get-to-know-the-api"></a><span data-ttu-id="e1a38-103">Usar o Graph Explorer para saber mais sobre a API</span><span class="sxs-lookup"><span data-stu-id="e1a38-103">Use Graph Explorer to get to know the API</span></span>

<span data-ttu-id="e1a38-104">A melhor maneira de começar a explorar os dados disponíveis pelo Microsoft Graph é usando o [Graph Explorer](https://aka.ms/ge).</span><span class="sxs-lookup"><span data-stu-id="e1a38-104">The easiest way to start exploring the data available through Microsoft Graph is to use [Graph Explorer](https://aka.ms/ge).</span></span> <span data-ttu-id="e1a38-105">O Graph Explorer permite criar solicitações REST (com suporte completo para CRUD), adaptar os cabeçalhos de solicitação HTTP e ver as respostas dos dados.</span><span class="sxs-lookup"><span data-stu-id="e1a38-105">Graph Explorer lets you craft REST requests (with full CRUD support), adapt the HTTP request headers, and see the data responses.</span></span> <span data-ttu-id="e1a38-106">Para ajudar você a começar, o Graph Explorer também oferece um conjunto de consultas de exemplo.</span><span class="sxs-lookup"><span data-stu-id="e1a38-106">To help you get started, Graph Explorer also provides a set of sample queries.</span></span>

<span data-ttu-id="e1a38-107">Experimente novas APIs antes de integrá-las em seu aplicativo.</span><span class="sxs-lookup"><span data-stu-id="e1a38-107">Experiment with new APIs before you integrate them into your application.</span></span>

## <a name="authentication"></a><span data-ttu-id="e1a38-108">Autenticação</span><span class="sxs-lookup"><span data-stu-id="e1a38-108">Authentication</span></span>

<span data-ttu-id="e1a38-109">Para acessar os dados no Microsoft Graph, seu aplicativo precisará adquirir um token de acesso do OAuth 2.0 e apresentá-lo ao Microsoft Graph em um dos itens a seguir:</span><span class="sxs-lookup"><span data-stu-id="e1a38-109">To access the data in Microsoft Graph, your application will need to acquire an OAuth 2.0 access token, and present it to Microsoft Graph in either of the following:</span></span>

- <span data-ttu-id="e1a38-110">O cabeçalho de solicitação HTTP *Authorization*, como um token de *Portador*</span><span class="sxs-lookup"><span data-stu-id="e1a38-110">The HTTP *Authorization* request header, as a *Bearer* token</span></span>
- <span data-ttu-id="e1a38-111">O construtor do cliente gráfico ao usar uma biblioteca de cliente do Microsoft Graph</span><span class="sxs-lookup"><span data-stu-id="e1a38-111">The graph client constructor, when using a Microsoft Graph client library</span></span>

<span data-ttu-id="e1a38-112">Use a API da Biblioteca de Autenticação Microsoft, [MSAL](https://docs.microsoft.com/en-us/azure/active-directory/develop/active-directory-v2-libraries), para adquirir o token de acesso para o Microsoft Graph.</span><span class="sxs-lookup"><span data-stu-id="e1a38-112">Use the Microsoft Authentication Library API, [MSAL](https://docs.microsoft.com/en-us/azure/active-directory/develop/active-directory-v2-libraries) to acquire the access token to Microsoft Graph.</span></span>

## <a name="consent-and-authorization"></a><span data-ttu-id="e1a38-113">Consentimento e autorização</span><span class="sxs-lookup"><span data-stu-id="e1a38-113">Consent and authorization</span></span>

<span data-ttu-id="e1a38-114">Aplique as seguintes práticas recomendadas de consentimento e autorização ao aplicativo:</span><span class="sxs-lookup"><span data-stu-id="e1a38-114">Apply the following best practices for consent and authorization in your app:</span></span>

- <span data-ttu-id="e1a38-115">**Use privilégios mínimos**.</span><span class="sxs-lookup"><span data-stu-id="e1a38-115">**Use least privilege**.</span></span> <span data-ttu-id="e1a38-116">Apenas solicite permissões absolutamente necessárias e somente quando você precisar delas.</span><span class="sxs-lookup"><span data-stu-id="e1a38-116">Only request permissions that are absolutely necessary, and only when you need them.</span></span> <span data-ttu-id="e1a38-117">Para as APIs que o aplicativo chama, verifique a seção de permissões nos tópicos do método (por exemplo, confira [como criar um usuário](../api-reference/v1.0/api/user_post_users.md) e escolha as permissões com menos privilégios.</span><span class="sxs-lookup"><span data-stu-id="e1a38-117">For the APIs your application calls, check the permissions section in the method topics (for example, see [creating a user](../api-reference/v1.0/api/user_post_users.md), and choose the least privileged permissions.</span></span> <span data-ttu-id="e1a38-118">Uma ver uma lista completa de permissões, confira [referência de permissões](permissions_reference.md).</span><span class="sxs-lookup"><span data-stu-id="e1a38-118">For a full list of permissions, see [permissions reference](permissions_reference.md).</span></span>

- <span data-ttu-id="e1a38-119">**Use o tipo de permissão correto com base nos cenários**.</span><span class="sxs-lookup"><span data-stu-id="e1a38-119">**Use the correct permission type based on scenarios**.</span></span> <span data-ttu-id="e1a38-120">Se você estiver criando um aplicativo interativo no qual um usuário conectado está presente, seu aplicativo deverá usar permissões *delegadas* nas quais o aplicativo recebe permissão de atuar como um usuário conectado ao fazer chamadas para o Microsoft Graph.</span><span class="sxs-lookup"><span data-stu-id="e1a38-120">If you're building an interactive application where a signed in user is present, your application should use *delegated* permissions, where the application is delegated permission to act as the signed-in user when making calls to Microsoft Graph.</span></span> <span data-ttu-id="e1a38-121">Se, no entanto, seu aplicativo for executado sem um usuário conectado, como um serviço em segundo plano ou um daemon, seu aplicativo deverá usar permissões de aplicativo.</span><span class="sxs-lookup"><span data-stu-id="e1a38-121">If, however, your application runs without a signed-in user, such as a background service or daemon, your application should use application permissions.</span></span>

    ><span data-ttu-id="e1a38-122">**Observação:** o uso de permissões de aplicativo para cenários interativos pode colocar a conformidade e a segurança de seu aplicativo em risco.</span><span class="sxs-lookup"><span data-stu-id="e1a38-122">**Note:** Using application permissions for interactive scenarios can put your application at compliance and security risk.</span></span> <span data-ttu-id="e1a38-123">Isso pode elevar inadvertidamente os privilégios de um usuário para acessar dados, contornando as políticas configuradas por um administrador.</span><span class="sxs-lookup"><span data-stu-id="e1a38-123">It can inadvertantly elevate a user's privileges to access data, circumnavigating policies configured by an administrator.</span></span>
<!-- LG: Use a more clear lead-in here, like "Consider the end user and admin experience"? -->
- <span data-ttu-id="e1a38-124">**Esteja atento ao configurar seu aplicativo**.</span><span class="sxs-lookup"><span data-stu-id="e1a38-124">**Be thoughtful when configuring your app**.</span></span> <span data-ttu-id="e1a38-125">Isso afetará diretamente as experiências do usuário final e do administrador, além da adoção e segurança do aplicativo.</span><span class="sxs-lookup"><span data-stu-id="e1a38-125">This will directly affect end user and admin experiences, along with application adoption and security.</span></span> <span data-ttu-id="e1a38-126">Por exemplo:</span><span class="sxs-lookup"><span data-stu-id="e1a38-126">For example:</span></span>

    - <span data-ttu-id="e1a38-127">A declaração de privacidade, os termos de uso, o nome, o logotipo e o domínio do seu aplicativo serão exibidos com consentimento e outras experiências. Portanto, verifique se foram configurados com cuidado para que sejam compreendidos pelos usuários finais.</span><span class="sxs-lookup"><span data-stu-id="e1a38-127">Your application's privacy statement, terms of use, name, logo and domain will show up in consent and other experiences - so make sure to configure these carefully so they are understood by your end-users.</span></span>
    - <span data-ttu-id="e1a38-128">Leve em consideração quem consentirá com seu aplicativo, seja o usuário final ou administrador, e configure seu aplicativo para [solicitar permissões de forma adequada](https://docs.microsoft.com/en-us/azure/active-directory/develop/active-directory-v2-scopes).</span><span class="sxs-lookup"><span data-stu-id="e1a38-128">Consider who will be consenting to your application - either end users or administrators - and configure your application to [request permissions appropriately](https://docs.microsoft.com/en-us/azure/active-directory/develop/active-directory-v2-scopes).</span></span>
    - <span data-ttu-id="e1a38-129">Verifique se você entende a diferença entre [consentimento estático, dinâmico e incremental](https://docs.microsoft.com/en-us/azure/active-directory/develop/active-directory-v2-compare#incremental-and-dynamic-consent).</span><span class="sxs-lookup"><span data-stu-id="e1a38-129">Ensure that you understand the difference between [static, dynamic and incremental consent](https://docs.microsoft.com/en-us/azure/active-directory/develop/active-directory-v2-compare#incremental-and-dynamic-consent).</span></span>

- <span data-ttu-id="e1a38-130">**Considere usar aplicativos multilocatários**.</span><span class="sxs-lookup"><span data-stu-id="e1a38-130">**Consider multi-tenant applications**.</span></span> <span data-ttu-id="e1a38-131">Tenha em mente que os clientes podem ter vários controles de aplicativo e consentimentos em diferentes estados.</span><span class="sxs-lookup"><span data-stu-id="e1a38-131">Expect customers to have various application and consent controls in different states.</span></span> <span data-ttu-id="e1a38-132">Por exemplo:</span><span class="sxs-lookup"><span data-stu-id="e1a38-132">For example:</span></span>

    - <span data-ttu-id="e1a38-133">os administradores de locatários podem desabilitar a capacidade dos usuários finais permitirem os aplicativos.</span><span class="sxs-lookup"><span data-stu-id="e1a38-133">Tenant administrators can disable the ability for end users to consent to applications.</span></span> <span data-ttu-id="e1a38-134">Nesse caso, um administrador precisaria consentir em nome de seus usuários.</span><span class="sxs-lookup"><span data-stu-id="e1a38-134">In this case, an administrator would need to consent on behalf of their users.</span></span>
    - <span data-ttu-id="e1a38-135">Os administradores de locatários podem definir políticas de autorização personalizadas, como impedir que os usuários leiam perfis de outros usuários ou limitar a criação de grupos de autoatendimento a um conjunto limitado de usuários.</span><span class="sxs-lookup"><span data-stu-id="e1a38-135">Tenant administrators can set custom authorization policies such as blocking users from reading other user's profiles, or limiting self-service group creation to a limited set of users.</span></span> <span data-ttu-id="e1a38-136">Nesse caso, seu aplicativo deve esperar que a resposta de erro 403 seja tratada ao atuar em nome de um usuário.</span><span class="sxs-lookup"><span data-stu-id="e1a38-136">In this case, your application should expect to handle 403 error response when acting on behalf of a user.</span></span>

## <a name="handle-responses-effectively"></a><span data-ttu-id="e1a38-137">Controlar as respostas com eficiência</span><span class="sxs-lookup"><span data-stu-id="e1a38-137">Handle responses effectively</span></span>

<span data-ttu-id="e1a38-138">Dependendo das solicitações feitas ao Microsoft Graph, seus aplicativos devem estar preparados para lidar com diferentes tipos de respostas.</span><span class="sxs-lookup"><span data-stu-id="e1a38-138">Depending on the requests you make to Microsoft Graph, your applications should be prepared to handle different types of responses.</span></span> <span data-ttu-id="e1a38-139">Veja a seguir algumas das práticas mais importantes a seguir para garantir que seu aplicativo se comporte de maneira confiável e previsível para seus usuários finais.</span><span class="sxs-lookup"><span data-stu-id="e1a38-139">The following are some of the most important practices to follow to ensure that your application behaves reliably and predictably for your end users.</span></span>

### <a name="pagination"></a><span data-ttu-id="e1a38-140">Paginação</span><span class="sxs-lookup"><span data-stu-id="e1a38-140">Pagination</span></span>

<span data-ttu-id="e1a38-141">Ao consultar um conjunto de recursos, você deve esperar que o Microsoft Graph retorne o conjunto de resultados em várias páginas devido aos limites de tamanho de página do lado do servidor.</span><span class="sxs-lookup"><span data-stu-id="e1a38-141">When querying a resource collection, you should expect that Microsoft Graph will the return result set in multiple pages, due to server-side page size limits.</span></span> <span data-ttu-id="e1a38-142">Quando um conjunto de resultados se estende por várias páginas, o Microsoft Graph retorna uma propriedade `@odata.nextLink` na resposta que contém uma URL para a próxima página de resultados.</span><span class="sxs-lookup"><span data-stu-id="e1a38-142">When a result set spans multiple pages, Microsoft Graph returns an `@odata.nextLink` property in the response that contains a URL to the next page of results.</span></span>

<span data-ttu-id="e1a38-143">Por exemplo, listar as mensagens de usuários conectados:</span><span class="sxs-lookup"><span data-stu-id="e1a38-143">For example, listing the signed-in users messages:</span></span>

```http
GET https://graph.microsoft.com/v1.0/me/messages
```

<span data-ttu-id="e1a38-144">retornaria uma resposta contendo uma propriedade `@odata.nextLink`, se o conjunto de resultados exceder o limite de tamanho de página do lado do servidor.</span><span class="sxs-lookup"><span data-stu-id="e1a38-144">Would return a response containing an `@odata.nextLink` property, if the result set exceeds the server-side page size limit.</span></span>

```json
"@odata.nextLink": "https://graph.microsoft.com/v1.0/me/messages?$skip=23"
```

><span data-ttu-id="e1a38-145">**Observação:** seu aplicativo deve **sempre** lidar com a possibilidade das respostas serem paginadas sem processamento e usar a propriedade `@odata.nextLink` para obter o próximo conjunto paginado de resultados, até que todas as páginas do conjunto de resultados sejam lidas.</span><span class="sxs-lookup"><span data-stu-id="e1a38-145">**Note:** Your application should **always** handle the possibility that the responses are paged in nature, and use the `@odata.nextLink` property to obtain the next paged set of results, until all pages of the result set have been read.</span></span> <span data-ttu-id="e1a38-146">A página final não conterá uma propriedade `@odata.nextLink`.</span><span class="sxs-lookup"><span data-stu-id="e1a38-146">The final page will not contain an `@odata.nextLink` property.</span></span> <span data-ttu-id="e1a38-147">Você deve incluir a URL inteira na propriedade `@odata:nextLink` na solicitação da próxima página de resultados, tratando toda a URL como uma cadeia de caracteres opaca.</span><span class="sxs-lookup"><span data-stu-id="e1a38-147">You should include the entire URL in the `@odata:nextLink` property in your request for the next page of results, treating the entire URL as an opaque string.</span></span>

<span data-ttu-id="e1a38-148">Para saber mais, confira [paginação](paging.md).</span><span class="sxs-lookup"><span data-stu-id="e1a38-148">For more details, see [paging](paging.md).</span></span>

### <a name="handling-expected-errors"></a><span data-ttu-id="e1a38-149">Como tratar erros esperados</span><span class="sxs-lookup"><span data-stu-id="e1a38-149">Handling expected errors</span></span>

<span data-ttu-id="e1a38-150">Como seu aplicativo tem que lidar com todas as respostas de erro (nos intervalos 400 e 500), dê especial atenção a determinados erros e respostas esperados que estão listados na tabela a seguir.</span><span class="sxs-lookup"><span data-stu-id="e1a38-150">While your application should handle all error responses (in the 400 and 500 ranges), pay special attention to certain expected errors and responses, listed in the following table.</span></span>

| <span data-ttu-id="e1a38-151">Tópico</span><span class="sxs-lookup"><span data-stu-id="e1a38-151">Topic</span></span>   | <span data-ttu-id="e1a38-152">Código de erro HTTP</span><span class="sxs-lookup"><span data-stu-id="e1a38-152">HTTP error code</span></span>    | <span data-ttu-id="e1a38-153">Prática recomendada</span><span class="sxs-lookup"><span data-stu-id="e1a38-153">Best practice</span></span>|
|:-----------|:--------|:----------|
| <span data-ttu-id="e1a38-154">O usuário não tem acesso</span><span class="sxs-lookup"><span data-stu-id="e1a38-154">User does not have access</span></span> | <span data-ttu-id="e1a38-155">403</span><span class="sxs-lookup"><span data-stu-id="e1a38-155">403 Forbidden</span></span> | <span data-ttu-id="e1a38-156">Se seu aplicativo estiver em execução, ele poderá encontrar esse erro, mesmo que tenha recebido as permissões necessárias por meio de uma experiência de consentimento.</span><span class="sxs-lookup"><span data-stu-id="e1a38-156">If your application is up and running, it could encounter this error even if it has been granted the necessary permissions through a consent experience.</span></span>  <span data-ttu-id="e1a38-157">Nesse caso, é mais provável que o usuário conectado não tenha privilégios para acessar o recurso solicitado.</span><span class="sxs-lookup"><span data-stu-id="e1a38-157">In this case, it's most likely that the signed-in user does not have privileges to access the resource requested.</span></span> <span data-ttu-id="e1a38-158">Seu aplicativo deve fornecer um erro genérico de "Acesso negado" para o usuário conectado.</span><span class="sxs-lookup"><span data-stu-id="e1a38-158">Your application should provide a generic "Access denied" error back to the signed-in user.</span></span> |
|<span data-ttu-id="e1a38-159">Não encontrado</span><span class="sxs-lookup"><span data-stu-id="e1a38-159">Not found</span></span>| <span data-ttu-id="e1a38-160">404</span><span class="sxs-lookup"><span data-stu-id="e1a38-160">404 errors</span></span> | <span data-ttu-id="e1a38-161">Em certos casos, um recurso solicitado pode não ser encontrado.</span><span class="sxs-lookup"><span data-stu-id="e1a38-161">In certain cases, a requested resource might not be found.</span></span> <span data-ttu-id="e1a38-162">Por exemplo, um recurso pode não existir porque ainda não foi provisionado (como a foto de um usuário) ou porque foi excluído.</span><span class="sxs-lookup"><span data-stu-id="e1a38-162">For example a resource might not exist, because it has not yet been provisioned (like a user's photo) or because it has been deleted.</span></span> <span data-ttu-id="e1a38-163">Alguns recursos excluídos *podem* ser totalmente restaurados em até 30 dias após a exclusão, como recursos de usuários, grupos e aplicativos, portanto, o aplicativo também deve levar isso em consideração.</span><span class="sxs-lookup"><span data-stu-id="e1a38-163">Some deleted resources *might* be fully restored within 30 days of deletion - such as user, group and application resources, so your application should also take this into account.</span></span>|
|<span data-ttu-id="e1a38-164">Limitação</span><span class="sxs-lookup"><span data-stu-id="e1a38-164">Throttling</span></span>|<span data-ttu-id="e1a38-165">429</span><span class="sxs-lookup"><span data-stu-id="e1a38-165">429:</span></span>|<span data-ttu-id="e1a38-166">As APIs podem limitar a qualquer momento por diversos motivos, portanto, seu aplicativo deve **sempre** estar preparado para manipular 429 respostas.</span><span class="sxs-lookup"><span data-stu-id="e1a38-166">APIs might throttle at any time for a variety of reasons, so your application must **always** be prepared to handle 429 responses.</span></span> <span data-ttu-id="e1a38-167">Essa resposta de erro inclui o campo *Retry-After* no cabeçalho de resposta HTTP.</span><span class="sxs-lookup"><span data-stu-id="e1a38-167">This error response includes the *Retry-After* field in the HTTP response header.</span></span> <span data-ttu-id="e1a38-168">Desativar solicitações usando o atraso *Retry-After* é a forma mais rápida de se recuperar da limitação.</span><span class="sxs-lookup"><span data-stu-id="e1a38-168">Backing off requests using the *Retry-After* delay is the fastest way to recover from throttling.</span></span> <span data-ttu-id="e1a38-169">Para saber mais, confira [limitação](throttling.md).</span><span class="sxs-lookup"><span data-stu-id="e1a38-169">For more information, see [throttling](throttling.md).</span></span>|
|<span data-ttu-id="e1a38-170">Serviço indisponível</span><span class="sxs-lookup"><span data-stu-id="e1a38-170">Service unavailable</span></span>| <span data-ttu-id="e1a38-171">503</span><span class="sxs-lookup"><span data-stu-id="e1a38-171">503</span></span> | <span data-ttu-id="e1a38-172">O motivo mais provável é que os serviços estejam ocupados.</span><span class="sxs-lookup"><span data-stu-id="e1a38-172">This is likely because the services is busy.</span></span> <span data-ttu-id="e1a38-173">Você deve empregar uma estratégia de retirada similar à 429.</span><span class="sxs-lookup"><span data-stu-id="e1a38-173">You should employ a back-off strategy similar to 429.</span></span> <span data-ttu-id="e1a38-174">Além disso, você deve **sempre** fazer novas solicitações de novas tentativas em uma nova conexão HTTP.</span><span class="sxs-lookup"><span data-stu-id="e1a38-174">Additionally, you should **always** make new retry requests over a new HTTP connection.</span></span>|

### <a name="evolvable-enums"></a><span data-ttu-id="e1a38-175">Enums que evoluem</span><span class="sxs-lookup"><span data-stu-id="e1a38-175">Evolvable enums</span></span>

<span data-ttu-id="e1a38-176">Os aplicativos cliente podem ser desfeitos com a adição de membros a um enum existente.</span><span class="sxs-lookup"><span data-stu-id="e1a38-176">Client applications can be broken by the addition of members to an existing enum.</span></span> <span data-ttu-id="e1a38-177">Para alguns dos enums mais recentes do Microsoft Graph, um mecanismo está disponível para permitir a adição de novos membros sem implicar em uma alteração significativa.</span><span class="sxs-lookup"><span data-stu-id="e1a38-177">For some newer enums in Microsoft Graph, a mechanism is available to allow for adding new members without incurring a breaking change.</span></span> <span data-ttu-id="e1a38-178">Nesses enums mais recentes, você verá um membro *sentinela* comum chamado `unknownFutureValue` que demarca membros enum conhecidos e desconhecidos.</span><span class="sxs-lookup"><span data-stu-id="e1a38-178">On these newer enums, you'll see a common *sentinel* member called `unknownFutureValue` that demarcates known and unknown enum members.</span></span> <span data-ttu-id="e1a38-179">Os membros conhecidos terão um número menor que o membro sentinela, enquanto os membros desconhecidos terão um valor maior.</span><span class="sxs-lookup"><span data-stu-id="e1a38-179">Known members will have a number less than the sentinel member, while unknown members will be greater in value.</span></span>
<span data-ttu-id="e1a38-180">Por padrão, o Microsoft Graph não retorna membros desconhecidos.</span><span class="sxs-lookup"><span data-stu-id="e1a38-180">By default, unknown members are not returned by Microsoft Graph.</span></span> <span data-ttu-id="e1a38-181">Se, no entanto, seu aplicativo tiver sido gravado para manipular a aparência de membros desconhecidos, ele poderá optar por receber membros enum desconhecidos usando um cabeçalho de solicitação HTTP *Prefer*.</span><span class="sxs-lookup"><span data-stu-id="e1a38-181">If, however, your application is written to handle the appearance of unknown members, it can opt-in to receive unknown enum members, using an HTTP *Prefer* request header.</span></span>

><span data-ttu-id="e1a38-182">**Observação:** se o aplicativo estiver preparado para lidar com membros enum desconhecidos, ele deverá aceitar a condição usando um cabeçalho solicitação HTTP *prefer*: `Prefer: include-unknown-enum-members`.</span><span class="sxs-lookup"><span data-stu-id="e1a38-182">**Note:** If your application is prepared to handle unknown enum members, it should opt-in by using an HTTP *prefer* request header: `Prefer: include-unknown-enum-members`.</span></span>


## <a name="storing-data-locally"></a><span data-ttu-id="e1a38-183">Armazenamento de dados no local</span><span class="sxs-lookup"><span data-stu-id="e1a38-183">Storing data locally</span></span>

<span data-ttu-id="e1a38-184">Idealmente, seu aplicativo deveria fazer chamadas para o Microsoft Graph para recuperar dados em tempo real conforme necessário.</span><span class="sxs-lookup"><span data-stu-id="e1a38-184">Your application should ideally make calls to Microsoft Graph to retrieve data in real time as necessary.</span></span> <span data-ttu-id="e1a38-185">Você só deve armazenar em cache ou armazenar dados localmente se um cenário específico assim o exigir e, se esse caso de uso for abrangido pelos seus termos de uso e pela política de privacidade e não violar os [termos de uso do Microsoft Graph](https://developer.microsoft.com/en-us/graph/docs/misc/terms-of-use).</span><span class="sxs-lookup"><span data-stu-id="e1a38-185">You should only cache or store data locally if required for a specific scenario, and if that use case is covered by your terms of use and privacy policy, and does not violate the [Microsoft Graph terms of use](https://developer.microsoft.com/en-us/graph/docs/misc/terms-of-use).</span></span> <span data-ttu-id="e1a38-186">O aplicativo também deve implementar políticas adequadas de retenção e de exclusão.</span><span class="sxs-lookup"><span data-stu-id="e1a38-186">Your application should also implement proper retention and deletion policies.</span></span>

## <a name="optimizations"></a><span data-ttu-id="e1a38-187">Otimizações</span><span class="sxs-lookup"><span data-stu-id="e1a38-187">Optimizations</span></span>

<span data-ttu-id="e1a38-188">Em geral, por motivos de desempenho e até mesmo segurança ou privacidade, você só deve obter os dados que seu aplicativo realmente precisar e nada mais.</span><span class="sxs-lookup"><span data-stu-id="e1a38-188">In general, for performance and even security or privacy reasons, you should only get the data your application really needs, and nothing more.</span></span>

### <a name="use-projections"></a><span data-ttu-id="e1a38-189">Usar projeções</span><span class="sxs-lookup"><span data-stu-id="e1a38-189">Use projections</span></span>

<span data-ttu-id="e1a38-190">Escolha apenas as propriedades que seu aplicativo realmente precisa e nada mais já que isso evitará tráfego de rede e processamento de dados desnecessários em seu aplicativo (e no serviço).</span><span class="sxs-lookup"><span data-stu-id="e1a38-190">Choose only the properties your application really needs and no more, because this saves unnecessary network traffic and data processing in your application (and in the service).</span></span>

><span data-ttu-id="e1a38-191">**Observação:** use o parâmetro de consulta `$select` para limitar as propriedades retornadas por uma consulta àquelas exigidas pelo aplicativo.</span><span class="sxs-lookup"><span data-stu-id="e1a38-191">**Note:** Use the `$select` query parameter to limit the properties returned by a query to those needed by your application.</span></span>

<span data-ttu-id="e1a38-192">Por exemplo, ao recuperar as mensagens do usuário conectado, você pode especificar que somente as propriedades **from** e **subject** sejam retornadas:</span><span class="sxs-lookup"><span data-stu-id="e1a38-192">For example, when retrieving the messages of the signed-in user, you can specify that only the **from** and **subject** properties be returned:</span></span>

```http
GET https://graph.microsoft.com/v1.0/me/messages?$select=from,subject
```

### <a name="getting-minimal-responses"></a><span data-ttu-id="e1a38-193">Como obter respostas mínimas</span><span class="sxs-lookup"><span data-stu-id="e1a38-193">Getting minimal responses</span></span>

<span data-ttu-id="e1a38-194">Para algumas operações, como PUT e PATCH (e, em alguns casos, POST), se seu aplicativo não precisa usar uma carga de resposta, solicite à API que retorne dados mínimos.</span><span class="sxs-lookup"><span data-stu-id="e1a38-194">For some operations, such as PUT and PATCH (and in some cases POST), if your application doesn't need to make use of a response payload, you can ask the API to return minimal data.</span></span> <span data-ttu-id="e1a38-195">Observe que alguns serviços já retornam uma resposta 204 No Content para operações PUT e PATCH.</span><span class="sxs-lookup"><span data-stu-id="e1a38-195">Note that some services already return a 204 No Content response for PUT and PATCH operations.</span></span>

><span data-ttu-id="e1a38-196">**Observação:** solicite respostas de representação mínima usando um cabeçalho de solicitação HTTP onde for apropriado: *Prefer: return=minimal*.</span><span class="sxs-lookup"><span data-stu-id="e1a38-196">**Note:** Request minimal representation responses using an HTTP request header where appropriate: *Prefer: return=minimal*.</span></span> <span data-ttu-id="e1a38-197">Observe que, em operações de criação, isso pode não ser adequado já que o aplicativo pode estar esperando receber o serviço gerado `id` para o objeto recém-criado na resposta.</span><span class="sxs-lookup"><span data-stu-id="e1a38-197">Note that for creation operations, this might not be appropriate because your application may expect to get the service generated `id` for the newly created object in the response.</span></span>

### <a name="track-changes-delta-query-and-webhook-notifications"></a><span data-ttu-id="e1a38-198">Controlar alterações: consulta delta e notificações de webhook</span><span class="sxs-lookup"><span data-stu-id="e1a38-198">Track changes: delta query and webhook notifications</span></span>

<span data-ttu-id="e1a38-199">Se for preciso que o aplicativo saiba quais alterações foram feitas nos dados, você provavelmente receberá uma notificação de webhook sempre que dados de seu interesse forem alterados.</span><span class="sxs-lookup"><span data-stu-id="e1a38-199">If your application needs to know about changes to data, you can get a webhook notification whenever data of interest has changed.</span></span> <span data-ttu-id="e1a38-200">Isso é mais eficiente do que simplesmente fazer pesquisas regularmente.</span><span class="sxs-lookup"><span data-stu-id="e1a38-200">This is more efficient than simply polling on a regular basis.</span></span>

<span data-ttu-id="e1a38-201">Use [notificações de webhook](../api-reference/v1.0/resources/webhooks.md) para receber notificações por push quando os dados forem alterados.</span><span class="sxs-lookup"><span data-stu-id="e1a38-201">Use [webhook notifications](../api-reference/v1.0/resources/webhooks.md) to get push notifications when data changes.</span></span>

<span data-ttu-id="e1a38-202">Use a consulta delta se seu aplicativo tiver que armazenar em cache ou armazenar dados do Microsoft Graph localmente, e mantê-los atualizados, ou tiver que controlar alterações nos dados por qualquer outro motivo.</span><span class="sxs-lookup"><span data-stu-id="e1a38-202">If your application is required to cache or store Microsoft Graph data locally, and keep that data up to date, or track changes to data for any other reasons, you should use delta query.</span></span> <span data-ttu-id="e1a38-203">Isso evitará a computação excessiva do aplicativo para recuperar dados que ele já possui, minimizar o tráfego de rede e reduzir a probabilidade de atingir um limite de limitação.</span><span class="sxs-lookup"><span data-stu-id="e1a38-203">This will avoid excessive computation by your application to retrieve data your application already has, minimize network traffic, and reduce the likelihood of reaching a throttling threshold.</span></span>

<span data-ttu-id="e1a38-204">Use a [consulta delta](delta_query_overview.md) para manter os dados atualizados com eficiência.</span><span class="sxs-lookup"><span data-stu-id="e1a38-204">Use [delta query](delta_query_overview.md) to efficiently keep data up to date.</span></span>

### <a name="using-webhooks-and-delta-query-together"></a><span data-ttu-id="e1a38-205">Usar consultas delta e webhooks em conjunto</span><span class="sxs-lookup"><span data-stu-id="e1a38-205">Using webhooks and delta query together</span></span>

<span data-ttu-id="e1a38-206">Os webhooks e a consulta delta geralmente funcionam melhor quando são usados em conjunto já que, se você usar a consulta delta sozinha, precisará calcular o intervalo de sondagem correto. Se esse intervalo for muito curto poderá levar a respostas vazias que desperdiçam recursos, mas, se for muito longo, você poderá acabar ficando com dados obsoletos.</span><span class="sxs-lookup"><span data-stu-id="e1a38-206">Webhooks and delta query are often used better together, because if you use delta query alone, you need to figure out the right polling interval - too short and this might lead to empty responses which wastes resources, too long and you might end up with stale data.</span></span> <span data-ttu-id="e1a38-207">Você terá o melhor de dois mundos se usar as notificações de webhook como o gatilho para fazer chamadas de consulta delta.</span><span class="sxs-lookup"><span data-stu-id="e1a38-207">If you use webhook notifications as the trigger to make delta query calls, you get the best of both worlds.</span></span>

<span data-ttu-id="e1a38-208">Use as [notificações de webhook](../api-reference/v1.0/resources/webhooks.md) como o gatilho para fazer chamadas de consulta delta.</span><span class="sxs-lookup"><span data-stu-id="e1a38-208">Use [webhook notifications](../api-reference/v1.0/resources/webhooks.md) as the trigger to make delta query calls.</span></span> <span data-ttu-id="e1a38-209">Você também deve garantir que seu aplicativo tenha um limite de pesquisa de backstop, caso nenhuma notificação seja acionada.</span><span class="sxs-lookup"><span data-stu-id="e1a38-209">You should also ensure that your application has a backstop polling threshold, in case no notifications are triggered.</span></span>

### <a name="batching"></a><span data-ttu-id="e1a38-210">Envio em lote</span><span class="sxs-lookup"><span data-stu-id="e1a38-210">Batching</span></span>

<span data-ttu-id="e1a38-211">Os lotes JSON permitem otimizar seu aplicativo combinando várias solicitações em um único objeto JSON.</span><span class="sxs-lookup"><span data-stu-id="e1a38-211">JSON batching allows you to optimize your application by combining multiple requests into a single JSON object.</span></span> <span data-ttu-id="e1a38-212">Combinar essas solicitações individuais em uma única solicitação em lote pode economizar latência de rede significativa para o aplicativo e conservar recursos de conexão.</span><span class="sxs-lookup"><span data-stu-id="e1a38-212">Combining individual requests into a single batch request can save the application significant network latency and can conserve connection resources.</span></span>

<span data-ttu-id="e1a38-213">Use o [envio em lote](json_batching.md) onde uma latência de rede significativa pode ter um grande impacto no desempenho.</span><span class="sxs-lookup"><span data-stu-id="e1a38-213">Use [batching](json_batching.md) where significant network latency can have a big impact on the performance.</span></span>

## <a name="reliability-and-support"></a><span data-ttu-id="e1a38-214">Confiabilidade e suporte</span><span class="sxs-lookup"><span data-stu-id="e1a38-214">Reliability and support</span></span>
<span data-ttu-id="e1a38-215">Para garantir a segurança e facilitar o suporte do aplicativo:</span><span class="sxs-lookup"><span data-stu-id="e1a38-215">To ensure reliability and facilitate support for your application:</span></span>

- <span data-ttu-id="e1a38-216">Respeite o TTL DNS e defina a conexão TTL para correspondê-lo.</span><span class="sxs-lookup"><span data-stu-id="e1a38-216">Honor DNS TTL and set connection TTL to match it.</span></span> <span data-ttu-id="e1a38-217">Isso garantirá a disponibilidade em caso de failovers.</span><span class="sxs-lookup"><span data-stu-id="e1a38-217">This ensures availability in case of failovers.</span></span>
- <span data-ttu-id="e1a38-218">Abra conexões para todas as respostas de DNS anunciadas.</span><span class="sxs-lookup"><span data-stu-id="e1a38-218">Open connections to all advertised DNS answers.</span></span>
- <span data-ttu-id="e1a38-219">Gerar um GUID exclusivo e o enviar em cada solicitação REST do Microsoft Graph.</span><span class="sxs-lookup"><span data-stu-id="e1a38-219">Generate a unique GUID and send it on each Microsoft Graph REST request.</span></span> <span data-ttu-id="e1a38-220">Isso ajudará a Microsoft a investigar os erros com maior facilidade, caso seja necessário relatar um problema com o Microsoft Graph.</span><span class="sxs-lookup"><span data-stu-id="e1a38-220">This will help Microsoft investigate any errors more easily if you need to report an issue with Microsoft Graph.</span></span>
  - <span data-ttu-id="e1a38-221">Em todas as solicitações do Microsoft Graph, gere um GUID exclusivo, envie-o no cabeçalho de solicitação HTTP do `client-request-id` e também registre-o nos logs dos aplicativos.</span><span class="sxs-lookup"><span data-stu-id="e1a38-221">On every request to Microsoft Graph, generate a unique GUID, send it in the `client-request-id` HTTP request header, and also log it in your application's logs.</span></span>
  - <span data-ttu-id="e1a38-222">Registre sempre o `request-id`, o `timestamp` e o `x-ms-ags-diagnostic` dos cabeçalhos de resposta HTTP.</span><span class="sxs-lookup"><span data-stu-id="e1a38-222">Always log the `request-id`, `timestamp` and `x-ms-ags-diagnostic` from the HTTP response headers.</span></span> <span data-ttu-id="e1a38-223">Estes, juntamente com o `client-request-id`, são necessários para relatar os problemas no [Stack Overflow](https://stackoverflow.com/questions/tagged/microsoft-graph) ou no Suporte da Microsoft.</span><span class="sxs-lookup"><span data-stu-id="e1a38-223">These, together with the `client-request-id`, are required when reporting issues in [Stack Overflow](https://stackoverflow.com/questions/tagged/microsoft-graph) or to Microsoft Support.</span></span>
