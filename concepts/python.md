# <a name="get-started-with-microsoft-graph-in-a-python-app"></a><span data-ttu-id="53a60-101">Introdução ao Microsoft Graph em um aplicativo Python</span><span class="sxs-lookup"><span data-stu-id="53a60-101">Get started with Microsoft Graph in a Python app</span></span> 

<span data-ttu-id="53a60-102">Este artigo descreve as tarefas obrigatórias para ter um token de acesso do Azure AD e chamar o Microsoft Graph.</span><span class="sxs-lookup"><span data-stu-id="53a60-102">This article describes the tasks required to get an access token from Azure AD and call Microsoft Graph.</span></span> <span data-ttu-id="53a60-103">Ele mostra passo a passo como [Enviar um email pelo Microsoft Graph do Python](https://github.com/microsoftgraph/python-sample-send-mail) e explica os principais conceitos que você implementa para usar a API do Microsoft Graph.</span><span class="sxs-lookup"><span data-stu-id="53a60-103">It walks you through [Sending mail via Microsoft Graph from Python](https://github.com/microsoftgraph/python-sample-send-mail) and explains the main concepts that you implement to use the Microsoft Graph API.</span></span> <span data-ttu-id="53a60-104">O artigo descreve como acessar o Microsoft Graph usando chamadas diretas REST.</span><span class="sxs-lookup"><span data-stu-id="53a60-104">The article describes how to access Microsoft Graph by using direct REST calls.</span></span>

![Enviar itens de formulário](https://raw.githubusercontent.com/microsoftgraph/python-sample-send-mail/master/static/images/sendmail.png)

## <a name="choosing-an-authentication-library"></a><span data-ttu-id="53a60-106">Escolher uma biblioteca de autenticação</span><span class="sxs-lookup"><span data-stu-id="53a60-106">Choosing an authentication library</span></span>

<span data-ttu-id="53a60-107">Para fazer chamadas para o Microsoft Graph, o aplicativo deve ter um token de acesso válido do Azure Active Directory (Azure AD), o serviço de identidade na nuvem da Microsoft, e o token deve ser transmitido em um cabeçalho HTTP com cada chamada para a API REST do Microsoft Graph.</span><span class="sxs-lookup"><span data-stu-id="53a60-107">To make calls to Microsoft Graph, your app must obtain a valid access token from Azure Active Directory (Azure AD), the Microsoft cloud identity service, and the token must be passed in an HTTP header with each call to the Microsoft Graph REST API.</span></span> <span data-ttu-id="53a60-108">A abordagem do Graph para autenticação é baseada nos padrões OAuth 2.0 e Open ID Connect, portanto exitem várias [bibliotecas de autenticação](https://docs.microsoft.com/pt-BR/azure/active-directory/develop/active-directory-v2-libraries) para você implementar a autenticação no seu aplicativo.</span><span class="sxs-lookup"><span data-stu-id="53a60-108">Graph's approach to authentication is based on the OAuth 2.0 and Open ID Connect standards, so there are many [authentication libraries](https://docs.microsoft.com/pt-BR/azure/active-directory/develop/active-directory-v2-libraries) that you can choose from to implement authentication in your application.</span></span>

<span data-ttu-id="53a60-109">A amostra abordada abaixo usa a biblioteca [Flask-OAuthlib](https://flask-oauthlib.readthedocs.io/en/latest/) para implementar o fluxo de trabalho [Concessão do Código de Autorização](https://tools.ietf.org/html/rfc6749#section-4.1) do OAuth 2.0, que é o fluxo de trabalho recomendado para aplicativos Web criados no Python.</span><span class="sxs-lookup"><span data-stu-id="53a60-109">The sample covered below uses the [Flask-OAuthlib](https://flask-oauthlib.readthedocs.io/en/latest/) library to implement OAuth 2.0 [Authorization Code Grant](https://tools.ietf.org/html/rfc6749#section-4.1) workflow, which is the recommended auth workflow for web applications written in Python.</span></span> <span data-ttu-id="53a60-110">Confira mais informações sobre outras opções de autenticação em [Amostras de autenticação do Python para o Microsoft Graph](https://github.com/microsoftgraph/python-sample-auth).</span><span class="sxs-lookup"><span data-stu-id="53a60-110">For information about other authentication options, see [Python authentication samples for Microsoft Graph](https://github.com/microsoftgraph/python-sample-auth).</span></span>

## <a name="installing-and-running-the-send-mail-sample"></a><span data-ttu-id="53a60-111">Instalar e executar a amostra send-mail</span><span class="sxs-lookup"><span data-stu-id="53a60-111">Installing and running the send-mail sample</span></span>

<span data-ttu-id="53a60-112">Para instalar e configurar a amostra de aplicativo, siga as instruções em [Instalar as amostras de REST do Python](https://github.com/microsoftgraph/python-sample-auth/blob/master/installation.md).</span><span class="sxs-lookup"><span data-stu-id="53a60-112">To install and configure the sample app, follow the instructions in [Installing the Python REST samples](https://github.com/microsoftgraph/python-sample-auth/blob/master/installation.md).</span></span> <span data-ttu-id="53a60-113">Para a amostra send-mail abordada abaixo, use este comando para clonar o repositório:</span><span class="sxs-lookup"><span data-stu-id="53a60-113">For the send-mail sample covered below, use this command to clone the repo:</span></span>

```git clone https://github.com/microsoftgraph/python-sample-send-mail.git```

<span data-ttu-id="53a60-114">Ao registrar o aplicativo conforme abordado nas [instruções de instalação](https://github.com/microsoftgraph/python-sample-auth/blob/master/installation.md), lembre-se de incluir as permissões **User.Read** e **Mail.Send**, que são necessárias para essa amostra.</span><span class="sxs-lookup"><span data-stu-id="53a60-114">When you register the application as covered in the [installation instructions](https://github.com/microsoftgraph/python-sample-auth/blob/master/installation.md), be sure to include the **User.Read** and **Mail.Send** permissions, which are required for this sample.</span></span>

<span data-ttu-id="53a60-115">Depois de concluir a instalação/configuração, execute a amostra de aplicativo seguindo as instruções para [executar a amostra](https://github.com/microsoftgraph/python-sample-send-mail#running-the-sample).</span><span class="sxs-lookup"><span data-stu-id="53a60-115">After completing the installation/configuration, you can run the sample app by following the instructions for [running the sample](https://github.com/microsoftgraph/python-sample-send-mail#running-the-sample).</span></span>

## <a name="code-walkthrough"></a><span data-ttu-id="53a60-116">Passo a passo do código</span><span class="sxs-lookup"><span data-stu-id="53a60-116">Code walkthrough</span></span>

<span data-ttu-id="53a60-117">A seguir está uma visão geral sobre o [código-fonte](https://github.com/microsoftgraph/python-sample-send-mail/blob/master/sample.py) para a amostra de aplicativo.</span><span class="sxs-lookup"><span data-stu-id="53a60-117">The following is an overview of the [source code](https://github.com/microsoftgraph/python-sample-send-mail/blob/master/sample.py) for the sample app.</span></span>

<span data-ttu-id="53a60-118">As primeiras linhas de código são as [importações](https://github.com/microsoftgraph/python-sample-send-mail/blob/master/sample.py#L4-L32) para os módulos e pacotes do Python usados na amostra:</span><span class="sxs-lookup"><span data-stu-id="53a60-118">The first few lines of code are the [imports](https://github.com/microsoftgraph/python-sample-send-mail/blob/master/sample.py#L4-L32) for the Python modules and packages used in the sample:</span></span>

* <span data-ttu-id="53a60-119">O módulo **base64** da biblioteca padrão é usado para codificar anexos de email.</span><span class="sxs-lookup"><span data-stu-id="53a60-119">The **base64** module from the standard library is used for encoding email attachments.</span></span>
* <span data-ttu-id="53a60-120">O módulo **mimetypes** é usado para determinar o tipo MIME para anexos de arquivos.</span><span class="sxs-lookup"><span data-stu-id="53a60-120">The **mimetypes** module is used to determine the MIME type for file attachments.</span></span>
* <span data-ttu-id="53a60-121">O módulo **os** fornece funcionalidade comum do sistema de arquivos.</span><span class="sxs-lookup"><span data-stu-id="53a60-121">The **os** module provides common file system functionality.</span></span>
* <span data-ttu-id="53a60-122">O módulo **pprint** da biblioteca padrão é usado para fazer o pretty-print de qualquer mensagem de erro enviada pelo Graph.</span><span class="sxs-lookup"><span data-stu-id="53a60-122">The **pprint** module from the standard library is used to pretty-print any error messages returned by Graph.</span></span> <span data-ttu-id="53a60-123">Por exemplo, se você tentar enviar para um endereço de email inválido.</span><span class="sxs-lookup"><span data-stu-id="53a60-123">(For example, if you try to send to an invalid email address.)</span></span>
* <span data-ttu-id="53a60-124">O módulo **uuid** da biblioteca padrão é usado para gerar uma cadeia aleatória de 36 caracteres para identificar de forma exclusiva cada solicitação do Graph.</span><span class="sxs-lookup"><span data-stu-id="53a60-124">The **uuid** module from the standard library is used to generate a random 36-character string to uniquely identify each Graph request.</span></span> <span data-ttu-id="53a60-125">Isso pode ser útil para fins de depuração.</span><span class="sxs-lookup"><span data-stu-id="53a60-125">This can be useful for debugging purposes.</span></span>
* <span data-ttu-id="53a60-126">O pacote **flask** é a estrutura da Web para a amostra.</span><span class="sxs-lookup"><span data-stu-id="53a60-126">The **flask** package is the web framework for the sample.</span></span>
* <span data-ttu-id="53a60-127">A classe **OAuth** de **flask_oauthlib.client** é um wrapper em torno do aplicativo Flask que implementa o fluxo de trabalho de autenticação do OAuth 2.0.</span><span class="sxs-lookup"><span data-stu-id="53a60-127">The **OAuth** class of **flask_oauthlib.client** is a wrapper around the Flask app that implements the OAuth 2.0 authentication workflow.</span></span>
* <span data-ttu-id="53a60-128">O módulo **config** contém as configurações de registro do aplicativo, conforme configuradas no processo de instalação acima.</span><span class="sxs-lookup"><span data-stu-id="53a60-128">The **config** module contains the application registration settings, as configured in the installation process above.</span></span>

<span data-ttu-id="53a60-129">Em seguida, [criamos um aplicativo do Flask](https://github.com/microsoftgraph/python-sample-send-mail/blob/master/sample.py#L15-L17) e o [objeto cliente do Graph](https://github.com/microsoftgraph/python-sample-send-mail/blob/master/sample.py#L19-L28), chamado **MSGRAPH**.</span><span class="sxs-lookup"><span data-stu-id="53a60-129">Next, we [create a Flask app](https://github.com/microsoftgraph/python-sample-send-mail/blob/master/sample.py#L15-L17) and then create the [Graph client object](https://github.com/microsoftgraph/python-sample-send-mail/blob/master/sample.py#L19-L28), named **MSGRAPH**.</span></span>

<span data-ttu-id="53a60-130">Após essas etapas de configuração inicial vêm três funções de manipulador de roteamento do Flask que implementam o fluxo de trabalho de autenticação: [homepage()](https://github.com/microsoftgraph/python-sample-send-mail/blob/master/sample.py#L30-L33), [login()](https://github.com/microsoftgraph/python-sample-send-mail/blob/master/sample.py#L35-L39) e [authorized()](https://github.com/microsoftgraph/python-sample-send-mail/blob/master/sample.py#L41-L48).</span><span class="sxs-lookup"><span data-stu-id="53a60-130">After those initial setup steps come three Flask route handler functions that implement the authentication workflow: [homepage()](https://github.com/microsoftgraph/python-sample-send-mail/blob/master/sample.py#L30-L33), [login()](https://github.com/microsoftgraph/python-sample-send-mail/blob/master/sample.py#L35-L39), and [authorized()](https://github.com/microsoftgraph/python-sample-send-mail/blob/master/sample.py#L41-L48).</span></span> <span data-ttu-id="53a60-131">Saiba mais sobre o fluxo de trabalho de autenticação na seção [Amostra de arquitetura](https://github.com/microsoftgraph/python-sample-auth#sample-architecture) do repositório de amostras de autenticação do Python.</span><span class="sxs-lookup"><span data-stu-id="53a60-131">For more information about the authentication workflow, see the [Sample architecture](https://github.com/microsoftgraph/python-sample-auth#sample-architecture) section of the Python authentication samples repo.</span></span>

<span data-ttu-id="53a60-132">O próximo manipulador de roteamento, [mailform()](https://github.com/microsoftgraph/python-sample-send-mail/blob/master/sample.py#L50-L83), é o formulário onde você especifica os destinatários, o assunto e o corpo do email.</span><span class="sxs-lookup"><span data-stu-id="53a60-132">The next route handler, [mailform()](https://github.com/microsoftgraph/python-sample-send-mail/blob/master/sample.py#L50-L83), is the form where you specify email recipients, subject, and body.</span></span> <span data-ttu-id="53a60-133">Observe que esta função também inclui nossas primeiras chamadas para o Graph, incluindo a recuperação do perfil do usuário e da foto do perfil, o upload da foto para o OneDrive e a criação de um link de compartilhamento.</span><span class="sxs-lookup"><span data-stu-id="53a60-133">Note that this function also includes our first calls to Graph, including retrieving the user profile and profile photo, uploading the photo to OneDrive, and creating a sharing link.</span></span> <span data-ttu-id="53a60-134">Os dados são [passados para o modelo mailform.html](https://github.com/microsoftgraph/python-sample-send-mail/blob/master/sample.py#L77-L83), em que o destinatário, o assunto e o corpo podem ser editados antes de enviar a mensagem.</span><span class="sxs-lookup"><span data-stu-id="53a60-134">The data is [passed to the mailform.html template](https://github.com/microsoftgraph/python-sample-send-mail/blob/master/sample.py#L77-L83), where the recipient, subject and body can be edited before sending the message.</span></span> 

<span data-ttu-id="53a60-135">Em seguida, está a função [send_mail()](https://github.com/microsoftgraph/python-sample-send-mail/blob/master/sample.py#L85-L107), que envia o email e exibe a resposta da API do Graph.</span><span class="sxs-lookup"><span data-stu-id="53a60-135">Next is the [send_mail()](https://github.com/microsoftgraph/python-sample-send-mail/blob/master/sample.py#L85-L107) function, which sends the email and displays the response from the Graph API.</span></span> <span data-ttu-id="53a60-136">Ela usa uma função auxiliar sendmail(), transmitindo os parâmetros da cadeia de caracteres de consulta que foram postados do formulário:</span><span class="sxs-lookup"><span data-stu-id="53a60-136">It uses a sendmail() helper function, passing to it the query string parameters that were posted from the form:</span></span>

```python
response = sendmail(client=MSGRAPH,
                    subject=flask.request.args['subject'],
                    recipients=flask.request.args['email'].split(';'),
                    body=flask.request.args['body'],
                    attachments=[profile_pic])
```

<span data-ttu-id="53a60-137">A função [get_token()](https://github.com/microsoftgraph/python-sample-send-mail/blob/master/sample.py#L109-L123) é usada pela instância do cliente Flask-OAuthlib (```MSGRAPH```) para obter um token de acesso sempre que fazemos chamadas para o Graph.</span><span class="sxs-lookup"><span data-stu-id="53a60-137">The [get_token()](https://github.com/microsoftgraph/python-sample-send-mail/blob/master/sample.py#L109-L123) function is used by the Flask-OAuthlib client instance (```MSGRAPH```) to obtain an access token whenever we make calls to Graph.</span></span> <span data-ttu-id="53a60-138">O token de acesso é transmitido em um cabeçalho HTTP chamado **Autorização**, mas não é preciso lidar com isso no seu código.</span><span class="sxs-lookup"><span data-stu-id="53a60-138">The access token is passed in an HTTP header named **Authorization**, but you don't need to deal with this in your code.</span></span> <span data-ttu-id="53a60-139">Você pode simplesmente fazer chamadas para o Graph por meio dos métodos verbais HTTP do cliente (por exemplo, get() ou post()), e a instância do cliente saberá chamar ```get_token()``` para obter um token, porque a função é [decorada](https://github.com/microsoftgraph/python-sample-send-mail/blob/master/sample.py#L109-L109) com ```tokengetter```.</span><span class="sxs-lookup"><span data-stu-id="53a60-139">You can simply make calls to Graph via the client's HTTP verb methods (for example, get() or post()), and the client instance will know to call ```get_token()``` to obtain a token, because the function is [decorated](https://github.com/microsoftgraph/python-sample-send-mail/blob/master/sample.py#L109-L109) with ```tokengetter```.</span></span>

<span data-ttu-id="53a60-140">O restante da amostra consiste em funções auxiliares que simplificam as atividades comuns do Graph:</span><span class="sxs-lookup"><span data-stu-id="53a60-140">The remainder of the sample is helper functions that simplify common Graph activities:</span></span>

* <span data-ttu-id="53a60-141">[request_headers()](https://github.com/microsoftgraph/python-sample-send-mail/blob/master/sample.py#L114-L123) retorna um dicionário de cabeçalhos HTTP que são enviados com cada chamada ao Graph.</span><span class="sxs-lookup"><span data-stu-id="53a60-141">[request_headers()](https://github.com/microsoftgraph/python-sample-send-mail/blob/master/sample.py#L114-L123) returns a dictionary of HTTP headers to be sent with each call to Graph.</span></span>
* <span data-ttu-id="53a60-142">[profile_photo()](https://github.com/microsoftgraph/python-sample-send-mail/blob/master/sample.py#L125-L154) </span><span class="sxs-lookup"><span data-stu-id="53a60-142">[profile_photo()](https://github.com/microsoftgraph/python-sample-send-mail/blob/master/sample.py#L125-L154) returns the user's profile photo and optionally saves a copy to a local file.</span></span>
* <span data-ttu-id="53a60-143">[sendmail()](https://github.com/microsoftgraph/python-sample-send-mail/blob/master/sample.py#L156-L202) envia uma mensagem usando o ponto de extremidade ```me/microsoft.graph.sendMail```.</span><span class="sxs-lookup"><span data-stu-id="53a60-143">[sendmail()](https://github.com/microsoftgraph/python-sample-send-mail/blob/master/sample.py#L156-L202) sends a message using the ```me/microsoft.graph.sendMail``` endpoint.</span></span>
* <span data-ttu-id="53a60-144">[sharing_link()](https://github.com/microsoftgraph/python-sample-send-mail/blob/master/sample.py#L204-L221) cria um link de compartilhamento para um item especificado no OneDrive.</span><span class="sxs-lookup"><span data-stu-id="53a60-144">[sharing_link()](https://github.com/microsoftgraph/python-sample-send-mail/blob/master/sample.py#L204-L221) creates a sharing link for a specified item in OneDrive.</span></span>
* <span data-ttu-id="53a60-145">[upload_file()](https://github.com/microsoftgraph/python-sample-send-mail/blob/master/sample.py#L223-L255) carrega um arquivo no OneDrive.</span><span class="sxs-lookup"><span data-stu-id="53a60-145">[upload_file()](https://github.com/microsoftgraph/python-sample-send-mail/blob/master/sample.py#L223-L255) uploads a file to OneDrive.</span></span>

<span data-ttu-id="53a60-146">Você pode achar essas funções auxiliares úteis em outras aplicações.</span><span class="sxs-lookup"><span data-stu-id="53a60-146">You may find these helper functions useful in other applications.</span></span>

## <a name="other-python-rest-samples"></a><span data-ttu-id="53a60-147">Outras amostras REST do Python</span><span class="sxs-lookup"><span data-stu-id="53a60-147">Other Python REST samples</span></span>

<span data-ttu-id="53a60-148">Aqui estão algumas outras amostras do Python que demonstram como trabalhar com vários aspectos do Microsoft Graph:</span><span class="sxs-lookup"><span data-stu-id="53a60-148">Here are some other Python samples that demonstrate how to work with various aspects of Microsoft Graph:</span></span>

* [<span data-ttu-id="53a60-149">Amostras de autenticação do Python para Microsoft Graph</span><span class="sxs-lookup"><span data-stu-id="53a60-149">Python authentication samples for Microsoft Graph</span></span>](https://github.com/microsoftgraph/python-sample-auth)
* [<span data-ttu-id="53a60-150">Trabalhar com respostas paginadas do Microsoft Graph no Python</span><span class="sxs-lookup"><span data-stu-id="53a60-150">Working with paginated Microsoft Graph responses in Python</span></span>](https://github.com/microsoftgraph/python-sample-pagination)
* [<span data-ttu-id="53a60-151">Trabalhar com extensões abertas do Graph no Python</span><span class="sxs-lookup"><span data-stu-id="53a60-151">Working with Graph open extensions in Python</span></span>](https://github.com/microsoftgraph/python-sample-open-extensions)
* [<span data-ttu-id="53a60-152">Conecte um aplicativo Web Python à API de Segurança</span><span class="sxs-lookup"><span data-stu-id="53a60-152">Connect a Python web app to the Security API</span></span>](https://github.com/microsoftgraph/python-security-rest-sample)

<span data-ttu-id="53a60-153">[Envie uma questão](https://github.com/microsoftgraph/python-sample-auth/issues) para nos informar sobre uma amostra específica que você queira ver.</span><span class="sxs-lookup"><span data-stu-id="53a60-153">If there's a particular sample you'd like to see, please let us know by [submitting an issue](https://github.com/microsoftgraph/python-sample-auth/issues).</span></span> <span data-ttu-id="53a60-154">Gostaríamos de ouvir seus comentários sobre qualquer cenário do Microsoft Graph que você queira criar no Python!</span><span class="sxs-lookup"><span data-stu-id="53a60-154">We're very interested in your feedback on any Microsoft Graph scenario you'd like to build in Python!</span></span>

<span data-ttu-id="53a60-155">A API do Microsoft Graph é uma API unificadora muito poderosa que pode ser usada para interagir com todos os tipos de dados da Microsoft.</span><span class="sxs-lookup"><span data-stu-id="53a60-155">The Microsoft Graph API is a very powerful, unifiying API that can be used to interact with all kinds of Microsoft data.</span></span> <span data-ttu-id="53a60-156">Confira a [documentação de desenvolvedor](https://developer.microsoft.com/pt-BR/graph/docs/concepts/overview) ou o [Explorador do Graph](https://developer.microsoft.com/pt-BR/graph/graph-explorer) para explorar o que mais você pode realizar com o Microsoft Graph.</span><span class="sxs-lookup"><span data-stu-id="53a60-156">Check out the [developer documentation](https://developer.microsoft.com/pt-BR/graph/docs/concepts/overview) or the [Graph Explorer](https://developer.microsoft.com/pt-BR/graph/graph-explorer) to explore what else you can accomplish with Microsoft Graph.</span></span>
